---
title: "[Day58] CartPage"
categories: [Ureca, React]
tags: [React, JS, PUT]
image:
  path: /assets/post/2025/ureca/day58_class_1.png
  alt: React
published: true
---

# CartPage

## ì „ì²´ íë¦„
ì‚¬ìš©ìê°€ /cart ê²½ë¡œë¡œ ì§„ì…  
1. Routerì—ì„œ cartPageLoader ì‹¤í–‰  
2. cartPageLoaderì—ì„œ getCartData í˜¸ì¶œ  
3. getCartDataê°€ axiosë¡œ ë°±ì—”ë“œ API ìš”ì²­  
4. ì‘ë‹µ ë°ì´í„°ë¥¼ ë°›ì•„ cartItemsë¡œ ë°˜í™˜  
5. ë°˜í™˜ëœ cartItemsê°€ CartPage ì»´í¬ë„ŒíŠ¸ì— ì „ë‹¬ë¨

### Router ì„¤ì • `router.jsx`

```js
{ path: '/cart', element: <CartPage />, loader: cartPageLoader },
```

- `cartPageLoader`ê°€ ì‹¤í–‰ë˜ì–´ ì´ˆê¸° ë°ì´í„°ë¥¼ ë¯¸ë¦¬ ë¡œë“œ
- `CartPage` ì»´í¬ë„ŒíŠ¸ê°€ í•´ë‹¹ ë°ì´í„°ë¥¼ ë°›ì•„ ë Œë”ë§

### cartPageLoader

```js
export const cartPageLoader = async () => {
  try {
    const cartItems = await getCartData()
    if (!cartItems || cartItems.length === 0) {
      return { cartItems: [] }
    }
    return cartItems
  } catch (err) {
    console.log('err', err)
  }
}
```

1. `getCartData` í•¨ìˆ˜ í˜¸ì¶œ â†’ ì¥ë°”êµ¬ë‹ˆ ë°ì´í„°ë¥¼ ë¹„ë™ê¸°ì ìœ¼ë¡œ ìš”ì²­
2. ì‘ë‹µ ë°›ì€ ë°ì´í„°ê°€ ì—†ê±°ë‚˜ ë¹ˆ ë°°ì—´ì´ë©´ ë¹ˆ ê°ì²´ ë°˜í™˜
3. ê·¸ ì™¸ì—ëŠ” ê·¸ëŒ€ë¡œ `cartItems` ë°˜í™˜

### getCartData (API í˜¸ì¶œ í•¨ìˆ˜)

```js
export const getCartData = async () => {
  try {
    const res = await axios.get(`/api/cart/`)
    return res.data
  } catch (err) {
    console.log('err', err)
  }
}
```

- `/api/cart/` ê²½ë¡œë¡œ GET ìš”ì²­
- ì‘ë‹µ ë°ì´í„°ë¥¼ ê·¸ëŒ€ë¡œ ë°˜í™˜ (`res.data`)

-----

## ê¸°ëŠ¥
- ì¥ë°”êµ¬ë‹ˆ í˜ì´ì§€ì—ì„œ ì´ ìˆ˜ëŸ‰ ë° ì´ ê¸ˆì•¡ í‘œì‹œ
- ìƒí’ˆ ìˆ˜ëŸ‰ ì¡°ì ˆ, ìƒí’ˆ ì‚­ì œ
- ë°±ì—”ë“œì™€ í†µì‹ í•˜ì—¬ ì¥ë°”êµ¬ë‹ˆ ì •ë³´ ìˆ˜ì • (GET, PUT, DELETE)

## ğŸ”¹ ì´ ìˆ˜ëŸ‰ ë° ê¸ˆì•¡ ê³„ì‚°
```js
// ì¥ë°”êµ¬ë‹ˆ ì´ ìˆ˜ëŸ‰ ê³„ì‚° reduce ê³ ì°¨í•¨ìˆ˜
const totalCount = items.reduce((sum, item) => sum + item.count, 0)
// ì´ ê³„ì‚°í•  ê¸ˆì•¡
const totalSum = items.reduce(
  (sum, item) => sum + Math.round(item.price * item.count * (1 - item.discount / 100)),
  0
)
```
- reduce ì‚¬ìš©í•´ì„œ ìˆ˜ëŸ‰, ê¸ˆì•¡ ê³„ì‚°
- í• ì¸ìœ¨(discount) ê³ ë ¤í•´ ê³„ì‚°

## ğŸ”¹ ìˆ˜ëŸ‰ ì¦ê°€: `increase(id)`

```js
const increase = id => {
  // ì•„ì´í…œì´ ì—†ìœ¼ë©´ ì¼ì° í•¨ìˆ˜ ì¢…ë£Œ
  const currentItem = items.find(item => item.id === id)
  if (!currentItem) return

  setItems(prev => prev.map(item => (item.id === id ? { ...item, count: item.count + 1 } : item)))
  const newCount = items.find(item => item.id === id).count + 1
  // cartApiì— ì—…ë°ì´íŠ¸ ìš”ì²­
  updateCartItemCount(id, newCount).catch(err => console.log('err', err)) // ì—ëŸ¬ì²˜ë¦¬ ì¶”ê°€;
}
```
- ë¡œì»¬ stateì—ì„œ ë¨¼ì € ìˆ˜ëŸ‰ ì¦ê°€
- ë³€ê²½ëœ ìˆ˜ëŸ‰ì„ `cartApi.js`ì˜ `updateCartItemCount`ë¡œ ì„œë²„ì— ë°˜ì˜ (PUT)

```js
export const updateCartItemCount = async (id, count) => {
  try {
    const cartItem = await axios.get(`/api/cart/${id}`)
    const updateItem = { ...cartItem.data, count }
    const res = await axios.put(`/api/cart/${id}`, updateItem)
    return res.data
  } catch (err) {
    console.log('err', err)
  }
}
```

- `GET`ìœ¼ë¡œ ê¸°ì¡´ ë°ì´í„° ë°›ì•„ì˜¨ ë’¤
- `count`ë§Œ ìˆ˜ì •í•´ì„œ `PUT` ìš”ì²­

## ğŸ”¹ ìˆ˜ëŸ‰ ê°ì†Œ: `decrease(id)`

```js
const decrease = id => {
  const currentItem = items.find(item => item.id === id)
  if (!currentItem) return

  setItems(prev =>
    prev.map(item =>
      item.id === id && item.count > 1 ? { ...item, count: item.count - 1 } : item
    )
  )
  const newCount = items.find(item => item.id === id).count - 1
  if (newCount >= 1) updateCartItemCount(id, newCount).catch(err => console.log('err', err))
}
```

- ìˆ˜ëŸ‰ì´ 1 ì´í•˜ê°€ ë˜ì§€ ì•Šë„ë¡ ì œí•œ
- ì„œë²„ì—ë„ ë™ì¼í•˜ê²Œ ê°±ì‹  ìš”ì²­

## ğŸ”¹ ì•„ì´í…œ ì‚­ì œ
```js
const hadleDelete = id => {
  if (window.confirm('ì •ë§ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) {
    setItems(prev => prev.filter(item => item.id !== id))
    removeFromCart(id)
  }
}
```
- ì‚­ì œ ì „ confirmìœ¼ë¡œ ì‚¬ìš©ì í™•ì¸
- ì‚­ì œ í›„ ë¡œì»¬ ìƒíƒœì™€ ì„œë²„ ëª¨ë‘ ê°±ì‹  (DELETE ìš”ì²­)

```js
export const removeFromCart = async id => {
  try {
    const res = await axios.delete(`/api/cart/${id}`)
    return res.data
  } catch (err) {
    console.log('err', err)
  }
}
```

------

## ì¥ë°”êµ¬ë‹ˆ í˜ì´ì§€

<img src="/assets/post/2025/ureca/day58_class_1.png" alt='day53' width=1300px>
<img src="/assets/post/2025/ureca/day58_class_2.png" alt='day53' width=1300px>


------

## END