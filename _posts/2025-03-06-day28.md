---
title: "[Day28] ì‡¼í•‘ëª° ì‹¤ìŠµ - ë¡œê·¸ì¸ & ë‹¤ì¤‘ ì„œë²„ ì„¸ì…˜ ë¬¸ì œ"
categories: [Ureca, SQL]
tags: [SQL]
image:
  path: /assets/post/2025/ureca/day28_class_5.png
  alt: sql
published: true
---

ì˜¤ëŠ˜ì€ ë¡œê·¸ì¸ê³¼ CORS ìœ„ì£¼ë¡œ ì‹¤ìŠµì´ ì§„í–‰ë˜ì—ˆë‹¤.    
ìˆ˜ì—…ì„ ë“¤ì„ ë• ë­”ê°€ ë”°ë¼ê°€ê¸° ë°”ë¹´ëŠ”ë° ì •ë¦¬ë¥¼ í•˜ë©´ì„œ ì¡°ê¸ˆì”© ì´í•´ê°€ ëœë‹¤ !    

---

## ë¡œê·¸ì¸ ì²˜ë¦¬
### ë°±ì—”ë“œ (BACK)
#### ë°ì´í„° ì ‘ê·¼ ê³„ì¸µ(DAO) : MemberDao.java 
ğŸ‘‰ ë°ì´í„°ë² ì´ìŠ¤ì—ì„œ íšŒì› ì •ë³´ ì¡°íšŒ

- ë°ì´í„°ë² ì´ìŠ¤ì—ì„œ ì´ë©”ì¼ê³¼ ë¹„ë°€ë²ˆí˜¸ê°€ ì¼ì¹˜í•˜ëŠ” íšŒì› ì •ë³´ë¥¼ ì¡°íšŒí•˜ëŠ” ë©”ì„œë“œ
- ì¡°íšŒëœ íšŒì›ì´ ì¡´ì¬í•˜ë©´ ë‹‰ë„¤ì„ ì •ë³´ë¥¼ ì„¤ì •í•˜ê³  ë°˜í™˜

```java
public Member login(Member m) throws Exception {
    Class.forName(DB_DRIVER);

    String sql = "select * from member where email = '" + m.getEmail() + "' and pwd = '" + m.getPwd() + "' ";
    try(
        Connection con=DriverManager.getConnection(DB_URL, DB_USER, DB_PW);
        Statement stmt = con.createStatement();
        ResultSet rs = stmt.executeQuery(sql);
        ) {	
        if(rs.next()) { // login ok
            String nickname = rs.getString("nickname");
            m.setNickname(nickname);
            return m;
        } else {
            return null;
        }
    }
}
```

#### ì„œë¹„ìŠ¤ ê³„ì¸µ (Service) : MemberService.java
ğŸ‘‰ memberDao.login(m)ì„ í˜¸ì¶œí•˜ì—¬ ë¡œê·¸ì¸ ê²€ì¦ì„ ìˆ˜í–‰

```java
public Member login(Member m) throws Exception {
    return memberDao.login(m);
}
```

#### ì»¨íŠ¸ë¡¤ëŸ¬ (Controller) : MemberController.java
ğŸ‘‰ /login ì—”ë“œí¬ì¸íŠ¸ë¥¼ í†µí•´ í´ë¼ì´ì–¸íŠ¸ ë¡œê·¸ì¸ ìš”ì²­ì„ ì²˜ë¦¬

- ë¡œê·¸ì¸ ì„±ê³µ ì‹œ ì„¸ì…˜(session)ì— ì‚¬ìš©ì ì •ë³´ë¥¼ ì €ì¥

```java
@PostMapping("login")
public Map<String, String> login(@RequestBody Member m, HttpServletRequest request) {
    Map<String,String> responseData=new HashMap();
    try {
        m=memberService.login(m);
        if(m!=null) {//login ok
            HttpSession session=request.getSession();
            System.out.println(session.getId());
            session.setAttribute("member", m);
            responseData.put("msg","ok");
        }else {//login fail
            responseData.put("msg","ë‹¤ì‹œ ë¡œê·¸ì¸ í•´ì£¼ì„¸ìš”");
        }
    } catch (Exception e) {//login error			
        e.printStackTrace();
        responseData.put("msg","ë‹¤ì‹œ ë¡œê·¸ì¸ í•´ì£¼ì„¸ìš”");
    }
    return responseData;
}
```

---

### í”„ë¡ íŠ¸ì—”ë“œ (FRONT)
#### index.js (ë¡œê·¸ì¸ ì´ë²¤íŠ¸ ì²˜ë¦¬)
- ì‚¬ìš©ìê°€ ì…ë ¥í•œ ì´ë©”ì¼ê³¼ ë¹„ë°€ë²ˆí˜¸ë¥¼ ì„œë²„ë¡œ ì „ì†¡
- fetch APIë¥¼ ì´ìš©í•˜ì—¬ /login ìš”ì²­ í›„ ì‘ë‹µ ë©”ì‹œì§€ë¥¼ alertìœ¼ë¡œ ì¶œë ¥

```js
document.getElementById("loginBtn").addEventListener("click", async () => {  
  const email = document.getElementById("loginEmail").value;
  const pwd = document.getElementById("loginPwd").value;
  const data = { email, pwd };
  let response = await fetch("http://localhost:8080/login", {
    method: "POST",
    headers: {
      "Content-Type": "application/json",
    },
    body: JSON.stringify(data),
  });
  response = await response.json();
  alert(response.msg);
});
```

### CORS ì˜¤ë¥˜
<img src="/assets/post/2025/ureca/day28_class_2.png" alt='' width=1300px>

```
Access to fetch at 'http://localhost:8080/login' from origin 'http://127.0.0.1:5500' has been blocked by CORS policy
```

- í”„ë¡ íŠ¸ì—”ë“œ(5500 í¬íŠ¸)ì™€ ë°±ì—”ë“œ(8080 í¬íŠ¸)ê°€ ë‹¤ë¥´ë¯€ë¡œ CORS ì •ì±…ì— ì˜í•´ ì°¨ë‹¨ë¨
- Access-Control-Allow-Origin í—¤ë”ê°€ ì‘ë‹µì— í¬í•¨ë˜ì§€ ì•Šì•„ ë¸Œë¼ìš°ì €ì—ì„œ ìš”ì²­ì„ ë§‰ìŒ

#### í•´ê²° ë°©ë²•
- ë°±ì—”ë“œì—ì„œ CORS ì„¤ì • ì¶”ê°€ (MyConfig.java) - íŠ¹ì • ì¶œì²˜(127.0.0.1:5500) í—ˆìš©
- í”„ë¡ íŠ¸ì—”ë“œì—ì„œ axios ì‚¬ìš© ë° withCredentials ì„¤ì • ì¶”ê°€

---

## ë‹¤ì¤‘ ì„œë²„ì—ì„œ ì„¸ì…˜ ë¬¸ì œ í•´ê²°í•˜ê¸°
### í”„ë¡ íŠ¸ì—”ë“œ - axios ì‚¬ìš©
ğŸ”¹  index.htmlì—ì„œ axios cdn ì„¤ì •
```html
<script src="https://unpkg.com/axios/dist/axios.min.js"></script>
```
  
ğŸ”¹ index.jsì—ì„œ axiosì— withCredentials ì„¤ì • -> ì„¸ì…˜ ì •ë³´ ìœ ì§€
```jsx
axios.defaults.withCredentials = true;
```
    
ğŸ”¹ index.jsì—ì„œ login ìš”ì²­ì„ axiosë¡œ ë³€ê²½
```js
document.getElementById("loginBtn").addEventListener("click", async () => {  
  const email = document.getElementById("loginEmail").value;
  const pwd = document.getElementById("loginPwd").value;
  const data = {  email, pwd };
  let response = await axios.post("http://localhost:8080/login", data );
  alert(response.data.msg);
});
```

### ë°±ì—”ë“œ - CORS ì„¤ì • ì¶”ê°€
ğŸ”¹ MyConfig.java ìƒì„±
- WebMvcConfigurerë¥¼ êµ¬í˜„í•˜ì—¬ CORS ì •ì±…ì„ ì„¤ì •.
- allowedOriginsì— í”„ë¡ íŠ¸ì—”ë“œ ë„ë©”ì¸ ì¶”ê°€.
- allowCredentials(true)ë¥¼ ì„¤ì •í•˜ì—¬ ì¿ í‚¤ì™€ ì„¸ì…˜ì„ í—ˆìš©.

```java
import org.springframework.context.annotation.Configuration;
import org.springframework.web.servlet.config.annotation.CorsRegistry;
import org.springframework.web.servlet.config.annotation.WebMvcConfigurer;

@Configuration
public class MyConfig implements WebMvcConfigurer{
	@Override
	public void addCorsMappings(CorsRegistry registry) {
		registry.addMapping("/**")
		.allowedOrigins("http://127.0.0.1:5500/")
		.allowedMethods("*")
		.allowedHeaders("*")
		.allowCredentials(true); //ì¿ í‚¤, ì„¸ì…˜ ì •ë³´ë„ í—ˆìš©
	}
}
```

### ê²°ê³¼ : ë¡œê·¸ì¸ ì„±ê³µ & ì¿ í‚¤ì— JSESSIONID ì €ì¥ë¨ 

<img src="/assets/post/2025/ureca/day28_class_3.png" alt='' width=1300px>

JSESSIONIDì— ë¡œê·¸ì¸ ì •ë³´ ì €ì¥
<img src="/assets/post/2025/ureca/day28_class_1.png" alt='' width=1300px>

Springì—ë„ session.getId() ì°í˜.
<img src="/assets/post/2025/ureca/day28_class_4.png" alt='' width=1300px>


---

## ğŸ”„ ìƒˆë¡œê³ ì¹¨í•˜ë©´ ë¡œê·¸ì¸ì´ í’€ë¦¬ëŠ” ì´ìœ ?
ìƒˆë¡œê³ ì¹¨ì„ í•˜ë©´ index.htmlì„ ìƒˆë¡œ ë¡œë“œë˜ë©´ì„œ ëª¨ë“  ë‚´ìš©ì´ ì‚¬ë¼ì§€ê³  ë‹¤ì‹œ êµ¬ì„±ë˜ëŠ”ê²ƒì„     
-> ê·¸ë˜ì„œ ì´ì „ì— jsë¡œ í–ˆë˜ ì‘ì—…ì´ ëª¨ë‘ ë‚ ë¼ê°€ëŠ” ê²ƒì„.

### ì´ë¥¼ í•´ê²°í•˜ê¸° ìœ„í•´ì„œ?
ë¡œê·¸ì¸ í›„ì— ì •ë³´ë¥¼ ìƒˆë¡œê³ ì¹¨ ì´í›„ì—ë„ ë‚¨ê²¨ë†“ì„ ìˆ˜ ìˆëŠ” ì €ì¥ì†Œì— ì €ì¥ì„ í•´ë‘¬ì•¼í•¨.     
-> Storage     
âœ… ë³´ì•ˆìƒìœ¼ë¡œëŠ” ë‹¤ ìœ„í—˜í•˜ì§€ë§Œ ì¡°ê¸ˆ ëœ ìœ„í—˜í•œ session storageë¥¼ ì‚¬ìš©í•œë‹¤.

## ë¡œê·¸ì¸ í™”ë©´ì´ ê°±ì‹ ë˜ëŠ” ë¬¸ì œ ì²˜ë¦¬
### ë¡œê·¸ì¸ ì„±ê³µ ì‹œ ì‚¬ìš©ì ì •ë³´ ì €ì¥

```jsx
document.getElementById("loginBtn").addEventListener("click", async () => {  
  const email = document.getElementById("loginEmail").value;
  const pwd = document.getElementById("loginPwd").value;
  let response = await axios.post("http://localhost:8080/login", { email, pwd });

  if (response.data.msg === "ok") {
    bootstrap.Modal.getInstance(document.getElementById("loginModal")).hide();
    document.getElementById("loginSpan").innerHTML = email;
    sessionStorage.setItem("email", email);
  }
});
```

### ìƒˆë¡œê³ ì¹¨ í›„ ë¡œê·¸ì¸ ìœ ì§€  
`window.onload`ì—ì„œ `sessionStorage` í™•ì¸í•˜ì—¬ ë¡œê·¸ì¸ ìƒíƒœ ìœ ì§€  

```jsx
window.onload = () => {  
  const email = sessionStorage.getItem("email");
  if (email) {
    document.getElementById("loginSpan").innerHTML = email + `<button id="logout">logout</button>`;
  }
};
```

### ë¡œê·¸ì•„ì›ƒ ê¸°ëŠ¥ ì¶”ê°€  
ë¡œê·¸ì•„ì›ƒ ë²„íŠ¼ í´ë¦­ ì‹œ `sessionStorage` ì‚­ì œ í›„ ìƒˆë¡œê³ ì¹¨  

```jsx
document.getElementById("loginSpan").addEventListener("click", (event) => {
  if (event.target.id === "logout") {
    sessionStorage.removeItem("email");
    window.location.reload();
  }
});
```

---

<details>
  <summary>ì „ì²´ ì½”ë“œ</summary>

```js
window.onload = async () => {
  const email = sessionStorage.getItem("email");
  if (email) {
    document.getElementById("loginSpn").innerHTML = email + ' <button>logout</button>';
  }
  axios.defaults.withCredentials = true;
  let productList = await fetch("http://localhost:8080/getAllProducts", { method: "GET" });
  productList = await productList.json();
  let productListDiv = '';
  productList.forEach((item) => {
    productListDiv += `
      <div>
        <h3>${item.prodname}</h3>
        <p>${item.price}</p>
        <button>ì¥ë°”êµ¬ë‹ˆ ë‹´ê¸°</button>
      </div>
    `;
  });
  document.getElementById("productListDiv").innerHTML = productListDiv;
};
```

</details>

### ê²°ê³¼ : session storageì— ì €ì¥ + ìƒˆë¡œê³ ì¹¨í•´ë„ ë¡œê·¸ì¸ ìœ ì§€
<img src="/assets/post/2025/ureca/day28_class_5.png" alt='' width=1300px>

---

## JSESSIONIDê°€ ìš”ì²­ì— í¬í•¨ë˜ì§€ ì•ŠëŠ” ë¬¸ì œ í•´ê²°

- í”„ë¡ íŠ¸ì—”ë“œ(:5500)ì—ì„œ ë¡œê·¸ì¸ ìš”ì²­ì„ ë³´ë‚¼ ë•Œ, ë°±ì—”ë“œ(:8080)ì—ì„œ JSESSIONIDê°€ ì¿ í‚¤ë¡œ ë°œê¸‰ë¨.
- í•˜ì§€ë§Œ, ë‹¤ìŒ ìš”ì²­ ì‹œ ë¸Œë¼ìš°ì €ê°€ JSESSIONID ì¿ í‚¤ë¥¼ í¬í•¨í•˜ì§€ ì•ŠìŒ.

### í•´ê²° ë°©ë²• 1. êµ¬ì¡° ë³€ê²½
#### `MyConfig.java` ì—ì„œ credential í•´ì œ
ğŸ‘‰ ê¸°ì¡´ì˜ CORS ì„¤ì •(@CrossOrigin)ì„ ì‚­ì œí•˜ê³ , ì •ì  ë¦¬ì†ŒìŠ¤ë¥¼ ì‚¬ìš©í•˜ë„ë¡ ë³€ê²½

```java
import org.springframework.context.annotation.Configuration;
import org.springframework.web.servlet.config.annotation.CorsRegistry;
import org.springframework.web.servlet.config.annotation.WebMvcConfigurer;

@Configuration
public class MyConfig implements WebMvcConfigurer{
//	@Override
//	public void addCorsMappings(CorsRegistry registry) {
//		registry.addMapping("/**")
//		.allowedOrigins("http://127.0.0.1:8080/")
//		.allowedMethods("*")
//		.allowedHeaders("*")
//		.allowCredentials(true); //ì¿ í‚¤, ì„¸ì…˜ ì •ë³´ë„ í—ˆìš©
//	}
}
```
        
#### ëª¨ë“  Controllerì—ì„œ @CrossOrigin í•´ì œ
ğŸ‘‰ ë°±ì—”ë“œì—ì„œ CORSë¥¼ ì§ì ‘ í•´ê²°í•˜ì§€ ì•Šê³ , í”„ë¡ íŠ¸ì—”ë“œë¥¼ Spring ì •ì  ë¦¬ì†ŒìŠ¤ë¡œ ì œê³µí•˜ë„ë¡ ë³€ê²½

#### ì •ì  ë¦¬ì†ŒìŠ¤(html, css, js)ë¥¼ ë°±ì—”ë“œ í”„ë¡œì íŠ¸ ë‚´ë¡œ ì´ë™

```
src/main/resources/static/
 â”œâ”€â”€ index.html
 â”œâ”€â”€ css/
 â”‚   â”œâ”€â”€ style.css
 â”œâ”€â”€ js/
 â”‚   â”œâ”€â”€ index.js
```

#### í”„ë¡ íŠ¸ì—”ë“œ (index.js) ë³€ê²½ ì‚¬í•­
ğŸ‘‰ axios.withCredentials ì„¤ì • ì œê±°
- axios.defaults.withCredentials = true; â†’ ì‚­ì œ
- ëª¨ë“  API ìš”ì²­ URLì„ ì ˆëŒ€ê²½ë¡œ(http://localhost:8080/...)ì—ì„œ ìƒëŒ€ê²½ë¡œ(getAllProducts ë“±)ë¡œ ë³€ê²½
- HTMLì´ :8080ì—ì„œ ì„œë¹™ë˜ë¯€ë¡œ ê°™ì€ ë„ë©”ì¸ì—ì„œ ìš”ì²­ì´ ì´ë£¨ì–´ì§


```js
//let productList=await fetch("http://localhost:8080/getAllProducts", { method:"GET"});
let productList=await fetch("getAllProducts", { method:"GET"});

let response = await fetch("insertMember", { // fetch("http://localhost:8080/insertMember"
    method: "POST",
    headers: {
        "Content-Type": "application/json",
    },
    body: JSON.stringify(data),
});
let response = await fetch("login", { // fetch("http://localhost:8080/login"
    method: "POST",
    headers: {
      "Content-Type": "application/json",
    },
    body: JSON.stringify(data),
});

// axios.post("http://localhost:8080/addCart");
axios.post("addCart");
```

#### addCart ì°íˆëŠ” ëª¨ìŠµ
<img src="/assets/post/2025/ureca/day28_class_6.png" alt='' width=1300px>

---

## END