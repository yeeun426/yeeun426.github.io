---
title: "[Day29] ì‡¼í•‘ëª° ì‹¤ìŠµ - MyBatis, SQL Injection"
categories: [Ureca, Spirng]
tags: [Spirng, MyBatis]
image:
  path: /assets/post/2025/ureca/day29_class_6.png
  alt: sql
published: true
---

## ğŸ“ Pull Request Template
.github/pull_request_template.md íŒŒì¼ì„ ë§Œë“¤ì–´ PRì„ ì‘ì„±í•  ë•Œ ì¼ê´€ì„±ì„ ìœ ì§€ <br/>
âœ… ë‹¤ì–‘í•œ í…œí”Œë¦¿ì´ ìˆìœ¼ë‹ˆ íŒ€ì›ê³¼ ìƒì˜í•´ì„œ ì •í•˜ê¸° ! ì•„ë˜ëŠ” í•˜ë‚˜ì˜ ì˜ˆì‹œ í…œí”Œë¦¿ì¼ ë¿

```md
## ê°œìš”
<!---- ë³€ê²½ ì‚¬í•­ ë° ê´€ë ¨ ì´ìŠˆì— ëŒ€í•´ ê°„ë‹¨í•˜ê²Œ ì‘ì„±í•´ì£¼ì„¸ìš”. ì–´ë–»ê²Œë³´ë‹¤ ë¬´ì—‡ì„ ì™œ ìˆ˜ì •í–ˆëŠ”ì§€ ì„¤ëª…í•´ì£¼ì„¸ìš”. -->
<!---- Resolves: #(Isuue Number) -->

## PR ìœ í˜•
ì–´ë–¤ ë³€ê²½ ì‚¬í•­ì´ ìˆë‚˜ìš”?

- [x] ìƒˆë¡œìš´ ê¸°ëŠ¥ ì¶”ê°€
- [ ] ë²„ê·¸ ìˆ˜ì •
- [ ] CSS ë“± ì‚¬ìš©ì UI ë””ìì¸ ë³€ê²½
- [ ] ì½”ë“œì— ì˜í–¥ì„ ì£¼ì§€ ì•ŠëŠ” ë³€ê²½ì‚¬í•­(ì˜¤íƒ€ ìˆ˜ì •, íƒ­ ì‚¬ì´ì¦ˆ ë³€ê²½, ë³€ìˆ˜ëª… ë³€ê²½)
- [ ] ì½”ë“œ ë¦¬íŒ©í† ë§
- [ ] ì£¼ì„ ì¶”ê°€ ë° ìˆ˜ì •
- [ ] ë¬¸ì„œ ìˆ˜ì •
- [ ] í…ŒìŠ¤íŠ¸ ì¶”ê°€, í…ŒìŠ¤íŠ¸ ë¦¬íŒ©í† ë§
- [ ] ë¹Œë“œ ë¶€ë¶„ í˜¹ì€ íŒ¨í‚¤ì§€ ë§¤ë‹ˆì € ìˆ˜ì •
- [ ] íŒŒì¼ í˜¹ì€ í´ë”ëª… ìˆ˜ì •
- [ ] íŒŒì¼ í˜¹ì€ í´ë” ì‚­ì œ

## PR Checklist
PRì´ ë‹¤ìŒ ìš”êµ¬ ì‚¬í•­ì„ ì¶©ì¡±í•˜ëŠ”ì§€ í™•ì¸í•˜ì„¸ìš”.

- [x] ì»¤ë°‹ ë©”ì‹œì§€ ì»¨ë²¤ì…˜ì— ë§ê²Œ ì‘ì„±í–ˆìŠµë‹ˆë‹¤.   
- [x] ë³€ê²½ ì‚¬í•­ì— ëŒ€í•œ í…ŒìŠ¤íŠ¸ë¥¼ í–ˆìŠµë‹ˆë‹¤(ë²„ê·¸ ìˆ˜ì •/ê¸°ëŠ¥ì— ëŒ€í•œ í…ŒìŠ¤íŠ¸).
```

âœ… pull Requestí•  ë•Œë§ˆë‹¤ ì„¤ì •í•´ë‘” í…œí”Œë¦¿ì´ ê°™ì´ ëœ¸
<img src="/assets/post/2025/ureca/day29_class_4.png" alt='' width=1300px>

    
## ğŸ“ commit message convention
``` 
feat: ìƒˆë¡œìš´ ê¸°ëŠ¥ ì¶”ê°€
fix: ë²„ê·¸ ìˆ˜ì •
docs: ë¬¸ì„œ ìˆ˜ì •
style: ì½”ë“œ í¬ë§· ë³€ê²½, ì„¸ë¯¸ì½œë¡  ëˆ„ë½, ì½”ë“œ ë³€ê²½ ì—†ìŒ
refactor: í”„ë¡œë•ì…˜ ì½”ë“œ ë¦¬íŒ©í„°ë§
test: í…ŒìŠ¤íŠ¸ ì¶”ê°€, í…ŒìŠ¤íŠ¸ ì½”ë“œ ë¦¬íŒ©í„°ë§, í”„ë¡œë•ì…˜ ì½”ë“œ ë³€ê²½ ì—†ìŒ
chore: ë¹Œë“œ í…ŒìŠ¤í¬ ì—…ë°ì´íŠ¸, íŒ¨í‚¤ì§€ ë§¤ë‹ˆì € í™˜ê²½ì„¤ì •, í”„ë¡œë•ì…˜ ì½”ë“œ ë³€ê²½ ì—†ìŒ
```

------

## ğŸ“ Postman
ì‹ ê¸°í•˜ê²Œë„ ì–´ì œ ì“¸ ì¼ì´ ìˆì–´ì„œ ì´ë¯¸ ì„¤ì¹˜í–ˆë‹¤!<br/>
ë§¥ì€ brewë¥¼ ì´ìš©í•´ì„œ ì„¤ì¹˜í•  ìˆ˜ ìˆë‹¤.

```bash
brew install --cask postman
```

### GET ìš”ì²­
âœ… GET ìš”ì²­ ì‹œ, ë°ì´í„°ë¥¼ URL íŒŒë¼ë¯¸í„°ì— ì¶”ê°€í•´ì„œ ìš”ì²­í•  ìˆ˜ ìˆìŒ
```bash
GET /users?id=1
```
<img src="/assets/post/2025/ureca/day29_class_1.png" alt='' width=1300px>

### POST ìš”ì²­
âœ… POST ìš”ì²­ì€ ë°ì´í„°ë¥¼ bodyì— ë‹´ì•„ ì „ì†¡
<img src="/assets/post/2025/ureca/day29_class_2.png" alt='' width=1300px>

#### Springì— ì°íŒ íšŒì›ê°€ì… ì„±ê³µ
<img src="/assets/post/2025/ureca/day29_class_3.png" alt='' width=1300px>

```
ì˜¤ëœë§Œì— ì–´ì œ í¬ìŠ¤íŠ¸ë§¨ì„ ì‚¬ìš©í•  ë•Œ parameterì™€ bodyê°€ í—·ê°ˆë ¸ëŠ”ë°
ì˜¤ëŠ˜ ë‹¤ì‹œ ë³´ë‹ˆ get ìš”ì²­í•  ë•Œ paramì„ ì‚¬ìš©, 
post ìš”ì²­ ì‹œì—ëŠ” bodyì— ë„£ì–´ ìš”ì²­ì´ ìƒê° ë‚¬ë‹¤. 
ì—­ì‹œ ì˜¤ë˜ ì‚¬ìš©í•˜ì§€ ì•Šìœ¼ë©´ ê¹Œë¨¹ëŠ”ë‹¤. ê³„ì†í•´ì„œ ê³µë¶€í•˜ì !
```

----

## ğŸ“ SQL Injection
SQL Injection(=SQL ì‚½ì… ê³µê²©)ì€ ì‚¬ìš©ìê°€ ì…ë ¥í•œ ë°ì´í„°ê°€ SQL ì¿¼ë¦¬ì˜ êµ¬ì¡°ë¥¼ ë³€ê²½í•˜ì—¬ ì˜ˆìƒì¹˜ ëª»í•œ ë™ì‘ì„ ìœ ë°œí•˜ëŠ” ë³´ì•ˆ ì·¨ì•½ì 

### SQL Injection ì˜ˆì‹œ
1. ë‹¤ìŒê³¼ ê°™ì€ ë¡œê·¸ì¸ ì¿¼ë¦¬ê°€ ìˆë‹¤
```java
Statement stmt = con.createStatement();
ResultSet rs = stmt.executeQuery("select * from member where email='" + email + "' and pwd='" + password + "'");
```

2. ì‚¬ìš©ìê°€ `email`ê³¼ `password` ì…ë ¥ë€ì— ë‹¤ìŒê³¼ ê°™ì€ ê°’ì„ ì…ë ¥í•˜ë©´
```plaintext
{
    "email" : "' or ''='",
    "pwd" : "' or ''='"  
}
```

3.  ì‹¤ì œ ì‹¤í–‰ë˜ëŠ” SQL

```sql
SELECT * FROM member WHERE email='' or ''='' AND pwd='' or ''=''
```

âœ… SQLì—ì„œëŠ” "(í°ë”°ì˜´í‘œ), '(ì‘ì€ë”°ì˜´í‘œ) ê°™ì€ ë¬¸ìê°€ SQL êµ¬ë¬¸ì˜ ì¼ë¶€ë¡œ í•´ì„ë  ìˆ˜ ìˆìŒ !
<br/>
- `email='' OR ''=''` â†’ í•­ìƒ ì°¸(True)
- `pwd='' OR ''=''` â†’ í•­ìƒ ì°¸(True)

ì¦‰, ì…ë ¥ ë°ì´í„°ê°€ SQLì˜ êµ¬ì¡°ë¥¼ ë°”ê¿” ëª¨ë“  ê³„ì •ì— ë¡œê·¸ì¸í•  ìˆ˜ ìˆëŠ” ë³´ì•ˆ ì·¨ì•½ì ì´ ë°œìƒ ! -> SQL Injection ê³µê²©ì˜ ëŒ€í‘œì ì¸ ì‚¬ë¡€

#### postmanì—ì„œ ì‹¤í–‰í•´ë³¸ ê²°ê³¼ -> ëª¨ë“  ê³„ì •ì—ì„œ ì ‘ê·¼ ê°€ëŠ¥í•˜ë¯€ë¡œ member í…Œì´ë¸”ì— ê°€ì¥ ì²« ê³„ì •ì´ ëœ¸
<img src="/assets/post/2025/ureca/day29_class_5.png" alt='' width=1300px>

-----

### PreparedStatement ì‚¬ìš©ìœ¼ë¡œ í•´ê²°
`PreparedStatement`ëŠ” **SQL ì¿¼ë¦¬ë¥¼ ë¯¸ë¦¬ ì»´íŒŒì¼í•œ í›„, ë°ì´í„°ë§Œ ë°”ì¸ë”©í•˜ëŠ” ë°©ì‹**ìœ¼ë¡œ ë™ì‘

<br/>

`statement`ë¥¼ ì‚¬ìš©í•œ ê¸°ì¡´ ì½”ë“œ

```java
public Member login(Member m) throws Exception {    
    Class.forName(DB_DRIVER); // Driver í´ë˜ìŠ¤ë¥¼ ë¡œë“œ
    Connection con=DriverManager.getConnection(DB_URL,DB_USER,DB_PW);
    
    Statement stmt=con.createStatement();
    
    ResultSet rs=stmt.executeQuery("select * from member where email='"+m.getEmail()+"' and pwd='"+m.getPwd()+"' ");
    if(rs.next()) {
        String nickname = rs.getString("nickname");
        m.setNickname(nickname);
    }
    return m;
}
```
ğŸ’¡ `PreparedStatement`ê°€ ì ìš©ëœ ì½”ë“œ

```java
public Member login(Member m) throws Exception {
    Class.forName(DB_DRIVER);
    Connection con=DriverManager.getConnection(DB_URL,DB_USER,DB_PW);
    
    PreparedStatement stmt=con.prepareStatement("select * from member where email=? and pwd=? ");
    
    stmt.setString(1, m.getEmail()); // ì²« ë²ˆì§¸ `?`ì— email ê°’ ë°”ì¸ë”©
    stmt.setString(2, m.getPwd()); // ë‘ ë²ˆì§¸ `?`ì— pwd ê°’ ë°”ì¸ë”©
    
    ResultSet rs=stmt.executeQuery();
    if(rs.next()) {
        String nickname=rs.getString("nickname");
        m.setNickname(nickname);
    }
    return m;
}
```

#### ì–´ë–»ê²Œ SQL Injectionì„ ë§‰ì„ê¹Œ?
- `?`ì— ë“¤ì–´ê°€ëŠ” ê°’ì€ ë‹¨ìˆœí•œ **ë°ì´í„°**ë¡œ ì·¨ê¸‰ë˜ë©°, SQLì˜ êµ¬ì¡°ë¥¼ ë°”ê¿€ ìˆ˜ ì—†ìŒ.
- ì…ë ¥ê°’ì´ ìë™ìœ¼ë¡œ ì´ìŠ¤ì¼€ì´í”„ ì²˜ë¦¬ë˜ì–´, SQL êµ¬ë¬¸ì´ ë³€í˜•ë˜ì§€ ì•ŠìŒ.
    - Escape(ì´ìŠ¤ì¼€ì´í”„)ë€ ? íŠ¹ì • ë¬¸ìê°€ htmlì´ë‚˜ ë‹¤ë¥¸ ë§ˆí¬ì—… ì–¸ì–´ë¡œ í•´ì„ë˜ì§€ ì•Šë„ë¡ ë³€í™˜í•˜ëŠ” ê³¼ì •

---------

## ğŸ“ MyBatisë¥¼ ì‚¬ìš©í•˜ê¸° (feat. ConnectionPool)

MyBatisëŠ” SQLì„ XMLì´ë‚˜ ì–´ë…¸í…Œì´ì…˜ìœ¼ë¡œ ê´€ë¦¬í•˜ë©´ì„œ ê°ì²´ì™€ ë§¤í•‘í•  ìˆ˜ ìˆëŠ” í”„ë ˆì„ì›Œí¬ì´ë‹¤.
JDBCì˜ ë²ˆê±°ë¡œìš´ Connection ë° PreparedStatement ì½”ë“œ ì—†ì´ ì†ì‰½ê²Œ SQLì„ ì‹¤í–‰í•  ìˆ˜ ìˆë‹¤.
ë˜í•œ Connection Poolê³¼ í•¨ê»˜ ì‚¬ìš©í•˜ë©´ ì„±ëŠ¥ë„ í–¥ìƒëœë‹¤.


### MyBatisë¥¼ ì‚¬ìš©í•˜ëŠ” ê³¼ì •
#### 1. SQL Mapper íŒŒì¼ ìƒì„± (src/main/resources/mapper/product.xml)
```xml
<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "https://mybatis.org/dtd/mybatis-3-mapper.dtd">
  
<mapper namespace="com.jes.cafe.dao.ProductDao">
  <select id="getAllProducts" resultType="Product" >
    select * from product
  </select>
</mapper>
```

- `namespace="com.jes.cafe.dao.ProductDao"`
    + í•´ë‹¹ mapperë¥¼ ProductDaoì™€ ì—°ê²°
- `<select id="getAllProducts" resultType="Product">`
    + getAllProducts ë©”ì„œë“œ ì‹¤í–‰ ì‹œ `select * from product` ì¿¼ë¦¬ë¥¼ ì‹¤í–‰í•˜ê³ , ê²°ê³¼ë¥¼ `Product` ê°ì²´ ë¦¬ìŠ¤íŠ¸ë¡œ ë³€í™˜

#### 2. application.properties ì„¤ì •
ğŸ‘‰ MyBatisê°€ XML Mapperë¥¼ ì¸ì‹í•˜ë„ë¡ ì„¤ì •ì„ ì¶”ê°€

```properties
logging.level.com.shop.cafe=debug

mybatis.type-aliases-package=com.shop.cafe.dto
mybatis.mapper-locations=mapper/*.xml
```

-  `logging.level.com.shop.cafe=debug`
    + MyBatis ì¿¼ë¦¬ ì‹¤í–‰ ë¡œê·¸ë¥¼ ë””ë²„ê·¸ ëª¨ë“œë¡œ ì¶œë ¥.
- `mybatis.type-aliases-package=com.shop.cafe.dto`
    + Product ê°™ì€ DTO í´ë˜ìŠ¤ì˜ íŒ¨í‚¤ì§€ë¥¼ ì§€ì •í•´ ë³„ì¹­ìœ¼ë¡œ ì‚¬ìš© ê°€ëŠ¥.
- `mybatis.mapper-locations=mapper/*.xml`
    + mapper í´ë” ì•ˆì˜ *.xml íŒŒì¼ì„ MyBatis Mapperë¡œ ë“±ë¡.

#### 3. ProductDao.javaë¥¼ interfaceë¡œ ë°”ê¿ˆ (@Mapper ë³€ê²½)
ğŸ‘‰ MyBatisë¥¼ ì‚¬ìš©í•˜ë©´ DAO í´ë˜ìŠ¤ë¥¼ ì§ì ‘ êµ¬í˜„í•˜ì§€ ì•Šê³  ì¸í„°í˜ì´ìŠ¤ë§Œ ë§Œë“¤ë©´ ìë™ìœ¼ë¡œ êµ¬í˜„ë¨.

```java
package com.shop.cafe.dao;

import java.util.*;
import org.apache.ibatis.annotations.Mapper;
import com.shop.cafe.dto.Product;

@Mapper
public interface ProductDao {
	public  List<Product> getAllProducts() throws Exception;
}
```
- `@Mapper`
    + MyBatisê°€ ì´ ì¸í„°í˜ì´ìŠ¤ë¥¼ êµ¬í˜„ì²´ë¡œ ë§¤í•‘í•˜ë„ë¡ í•¨.
- `List<Product> getAllProducts();`
    + mapper/product.xmlì— ìˆëŠ” `<select id="getAllProducts">`ì™€ ì—°ê²°ë¨.

#### ì´ ì½”ë“œ ì •ë¦¬ 
ğŸ”¹ Productì— ì ìš©
<img src="/assets/post/2025/ureca/day29_class_6.png" alt='' width=1300px>

ğŸ”¹ Memberì— ì ìš© (login, signUp)
<img src="/assets/post/2025/ureca/day29_class_7.png" alt='' width=1300px>

---

ì˜¤ëŠ˜ì€ ìˆ˜ì—… ë”°ë¼ê°€ë©´ì„œ ì¤‘ê°„ ì¤‘ê°„ì— ê²°ê³¼ê°€ ë‹¤ë¥´ê²Œ ë– ì„œ ì§„ë„ ë”°ë¼ê°€ëŠë¼ ì‰¬ëŠ”ì‹œê°„ì—ë„ ê³„ì† ì •ë¦¬í•˜ê³ , ëª»ë“¤ì€ê±°ëŠ” ì°¾ì•„ë³´ë©´ì„œ ì±„ì›Œë‚˜ê°”ë‹¤. gitë„ ë§ì½ì´ê³  postman ê²°ê³¼ë„ ìê¾¸ ë‹¬ë¼ì„œ ì •ì‹ ì—†ì—ˆë‹¤.
í•™êµ ìˆ˜ì—…ë„ ì˜¤ëŠ˜ì²˜ëŸ¼ ì—´ì‹¬íˆ ë“£ì§€ëŠ” ì•Šì•˜ë˜ê±°ê°™ì€ë°,, ê·¸ë˜ë„ ë­”ê°€ ë¿Œë“¯í•œ,,ê·¸ëŸ°,,ëŠë‚Œ !

---

JWT

## END

