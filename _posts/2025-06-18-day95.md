---
title: "[U+Pick #1] Function Calling ê¸°ë°˜ ê²°í•© í• ì¸ ì±—ë´‡ êµ¬ì¶•"
categories: [Ureca, Project]
tags: [React, JS, Express, MongoDB, React Query]
image:
  path: /assets/post/2025/ureca/U+Pick.png
  alt: project
published: true
---

# âœ… ì˜¤ëŠ˜ì˜ ëª©í‘œ

- [x] GPT-4.1-mini Function Callingìœ¼ë¡œ ê°€ì¡±ê²°í•© í• ì¸ ê³„ì‚° ê¸°ëŠ¥ êµ¬í˜„
- [x] í”„ë¡ íŠ¸ React + ë°±ì—”ë“œ Express ê¸°ë°˜ ì±—ë´‡ ì„œë¹„ìŠ¤ êµ¬ì¶•
- [x] ê²°í•© í• ì¸ ê¸ˆì•¡ ê³„ì‚° ë¡œì§ ëª¨ë“ˆí™” ë° Function Schema ì„¤ê³„

---

# ğŸ§© ë¬¸ì œ ìƒí™© / ë°°ê²½

- LG U+ ìš”ê¸ˆì œì— ëŒ€í•œ ìƒë‹´/ì¶”ì²œ ê¸°ëŠ¥ì„ ì±—ë´‡ í˜•íƒœë¡œ ì œê³µí•˜ê³  ì‹¶ì—ˆìŒ
- ê°€ì¡±ê²°í•© í• ì¸ ê³„ì‚°ì€ ë‹¨ìˆœ í…ìŠ¤íŠ¸ ë‹µë³€ìœ¼ë¡œ ì œê³µí•˜ê¸°ì—ëŠ” ì •í™•ë„ê°€ ë‚®ê³  ë³µì¡í•œ ê·œì¹™ì„ í¬í•¨
- **GPT Function Calling** ê¸°ëŠ¥ì„ ì‚¬ìš©í•˜ë©´ ì‹¤ì œ ê³„ì‚° ë¡œì§ê³¼ GPTì˜ ìì—°ì–´ ì²˜ë¦¬ë¥¼ ìœ ì—°í•˜ê²Œ ì¡°í•©í•  ìˆ˜ ìˆë‹¤ê³  íŒë‹¨
- React ê¸°ë°˜ì˜ ì‹¬í”Œí•œ ì±— UIë¡œ ì‚¬ìš©ì ê²½í—˜ì„ í…ŒìŠ¤íŠ¸í•˜ê³ ì í•¨

---

# ğŸ› ï¸ í•´ê²° ê³¼ì • / ì½”ë“œ ì •ë¦¬

## ğŸ”¸ í”„ë¡œì íŠ¸ êµ¬ì¡°

```plaintext
backend/
  â”œâ”€â”€ server.js
  â”œâ”€â”€ openai 
    â”œâ”€â”€ client.js
  â”œâ”€â”€ controllers
    â”œâ”€â”€ gptChat.js
  â”œâ”€â”€ functions
    â”œâ”€â”€ gptFunctions.js
    â”œâ”€â”€ calculateFamilyBundle.js
frontend/
  â”œâ”€â”€ components
    â”œâ”€â”€ ChatBox.jsx
```

## ğŸ”¸ ê°€ì¡±ê²°í•© í• ì¸ ê³„ì‚° ë¡œì§ ëª¨ë“ˆí™”

```js
// backend/functions/calculateFamilyBundle.js
export function calculateFamilyBundle(prices) {
  const phoneCount = prices.length;
  const discounts = prices.map((price) => {
    if (phoneCount >= 4) {
      if (price >= 88000) return 8800;
      if (price >= 69000) return 6600;
      return 4400;
    }
    if (phoneCount === 3) {
      if (price >= 88000) return 6600;
      if (price >= 69000) return 5500;
      return 3300;
    }
    if (phoneCount === 2) {
      if (price >= 88000) return 4400;
      if (price >= 69000) return 3300;
      return 2200;
    }
    return 0;
  });

  const total = discounts.reduce((sum, d) => sum + d, 0);
  return { phoneCount, discounts, totalDiscount: total };
}
```

<img src="/assets/post/2025/ureca/day95_proj_1.png" alt='' width=1000px>

âœ… ê°€ê²©ë³„ë¡œ í• ì¸ìœ¨ì„ ê³„ì‚°í•˜ëŠ” í•¨ìˆ˜ë¥¼ ë³„ë„ë¡œ ë¶„ë¦¬        
âœ… í• ì¸ ì´ì•¡, ì¸ì›ìˆ˜ë¥¼ í•¨ê»˜ ë¦¬í„´

----

## ğŸ”¸ Function Calling Schema ì„¤ê³„ - `backend/functions/gptFunctions.js`

```js
export const calculateFamilyBundleDiscountSchema = {
  name: "calculateFamilyBundleDiscount",
  description: "ê°€ì¡± ê²°í•© í• ì¸ ê³„ì‚°",
  parameters: {
    type: "object",
    properties: {
      planNames: {
        type: "array",
        items: { type: "string" },
        description: "ê²°í•©í•  ìš”ê¸ˆì œ ì´ë¦„ ë¦¬ìŠ¤íŠ¸",
      },
      planPrices: {
        type: "array",
        items: { type: "number" },
        description: "ê²°í•©í•  ìš”ê¸ˆì œ ê°€ê²© ë¦¬ìŠ¤íŠ¸",
      },
    },
  },
};
```

âœ… GPTê°€ ì–´ë–¤ ë§¤ê°œë³€ìˆ˜ë¥¼ ë³´ë‚´ì•¼ í•˜ëŠ”ì§€ ëª…í™•íˆ ì •ì˜ (planNames, planPrices)       
âœ… ChatGPTê°€ ìƒí™©ì— ë”°ë¼ ìë™ìœ¼ë¡œ í•¨ìˆ˜ í˜¸ì¶œì„ ì‹œë„í•  ìˆ˜ ìˆë„ë¡ ì„¤ê³„


----

## ğŸ”¸ GPT Chat ì»¨íŠ¸ë¡¤ëŸ¬ êµ¬ì„± ë° Function Calling ì²˜ë¦¬ íë¦„

ì´ ì„œë¹„ìŠ¤ì˜ ê°€ì¥ í•µì‹¬ ë¶€ë¶„ì€ `gptChatHandler`

1. ì‚¬ìš©ìê°€ ì…ë ¥í•œ ë©”ì‹œì§€ë¥¼ GPT-4.1-minië¡œ ì „ë‹¬
2. ìƒí™©ì— ë”°ë¼ Function Callingì„ ìœ ë„
3. ì‹¤ì œ í• ì¸ ê³„ì‚° ë¡œì§ê³¼ ì—°ê³„
4. ìµœì¢… ê²°ê³¼ë¥¼ ìì—°ì–´ ë‹µë³€ìœ¼ë¡œ ë³€í™˜ í›„ ì‘ë‹µ

---

### âœ… ì½”ë“œ íë¦„

```plaintext
ì‚¬ìš©ì ì…ë ¥ â†’ í‚¤ì›Œë“œ ë£° ê²€ì‚¬ â†’ GPT í˜¸ì¶œ â†’ Function í˜¸ì¶œ â†’ í• ì¸ ê³„ì‚° â†’ ìµœì¢… ë‹µë³€
```

---

### âœ… systemPrompt ì—­í• 

```js
const systemPrompt = `
ë‹¹ì‹ ì€ ì¹œì ˆí•˜ê³  ì „ë¬¸ì ì¸ LG U+ í†µì‹  ìš”ê¸ˆì œ ì¶”ì²œ ìƒë‹´ì‚¬ì…ë‹ˆë‹¤.
...
- ê³ ê°ì´ ìš”ê¸ˆì œëª… ë˜ëŠ” ìš”ê¸ˆì œ ê°€ê²©ì„ ì…ë ¥í•œ ê²½ìš°, ë°˜ë“œì‹œ calculateFamilyBundleDiscount í•¨ìˆ˜ë¥¼ í˜¸ì¶œí•˜ì„¸ìš”.
`;
```

â†’ **GPTê°€ ì–´ë–¤ ì–´ì¡°ë¡œ, ì–´ë–¤ ê¸°ëŠ¥ì„ ì¨ì•¼ í•˜ëŠ”ì§€ ëª…í™•í•˜ê²Œ ìœ ë„**í•˜ëŠ” ì—­í•       
â†’ Function Callingì„ ìë™ìœ¼ë¡œ ìœ ë„í•˜ê¸° ìœ„í•´ "ë°˜ë“œì‹œ í•¨ìˆ˜ë¥¼ í˜¸ì¶œí•˜ì„¸ìš”" ë¬¸êµ¬ ì‚¬ìš©       

---

### âœ… í‚¤ì›Œë“œ ê¸°ë°˜ ì„ ì²˜ë¦¬ (Rule-based fallback)

```js
const keywordRules = [
  {
    pattern: /ì§€ì¸\s?ê²°í•©/,
    response:
      "ì§€ì¸ ê²°í•© í• ì¸ì— ëŒ€í•œ ì •ë³´ëŠ” ì €í¬ ì„œë¹„ìŠ¤ì—ì„œ í™•ì¸í•  ìˆ˜ ìˆì–´ìš”\n`U+Pick url`",
  },
  {
    pattern: /ì–´ë–¤\s?ê²°í•©.*(í• ì¸|ê°€ëŠ¥|ë°›ì„|ìˆë‚˜|ì•Œë ¤)/,
    response: "ì§€ì¸ ê²°í•©ê³¼ ê°€ì¡± ê²°í•© ì¤‘ ì–´ë–¤ ê²°í•©ìœ¼ë¡œ ì•Œë ¤ë“œë¦´ê¹Œìš”?",
  },
];
```

â†’ GPT í˜¸ì¶œ ì „ì— íŒ¨í„´ ë§¤ì¹­ìœ¼ë¡œ ì¦‰ì‹œ ì‘ë‹µì´ ê°€ëŠ¥í•œ ê²½ìš° ì²˜ë¦¬
â†’ **ì±—ë´‡ UXì˜ ë°˜ì‘ì†ë„ì™€ ì‘ë‹µ ì¼ê´€ì„± í™•ë³´**
â†’ ì•„ì£¼ ë‹¨ìˆœí•œ FAQ ì„± íŒ¨í„´ë“¤ì€ ë¹ ë¥´ê²Œ ëŒ€ì‘ (API ë¹„ìš© ì ˆê° íš¨ê³¼ë„ ìˆìŒ)

> ? ì •ê·œì‹ ì½”ë“œ ì˜ë¯¸
> 

---

### âœ… Function í˜¸ì¶œ íë¦„

```js
const response = await openai.chat.completions.create({
  model: "gpt-4.1-mini",
  messages: systemMessages,
  functions,
  function_call: "auto",
});
```

â†’ GPTê°€ ìƒí™©ì„ ë³´ê³  ì•Œì•„ì„œ `calculateFamilyBundleDiscount` ë¥¼ í˜¸ì¶œí• ì§€ ë§ì§€ ì„ íƒí•˜ë„ë¡ êµ¬ì„±
â†’ **ìë™ìœ¼ë¡œ ì‚¬ìš©ì ì…ë ¥ê³¼ í•¨ìˆ˜ í˜¸ì¶œ íë¦„ì„ ìì—°ìŠ¤ëŸ½ê²Œ ì—°ê²°**

---

### âœ… í•¨ìˆ˜ í˜¸ì¶œ ì—¬ë¶€ íŒë‹¨

```js
const funcCall = choice.message.function_call;

if (!funcCall) {
  return res.send(choice.message.content);
}
```

â†’ GPTê°€ í•¨ìˆ˜ í˜¸ì¶œì´ í•„ìš” ì—†ë‹¤ê³  íŒë‹¨í•œ ê²½ìš°, ë°”ë¡œ ìì—°ì–´ ì‘ë‹µì„ ë¦¬í„´
â†’ ë°˜ë©´, í˜¸ì¶œí•œ ê²½ìš°ì—ëŠ” arguments ë¥¼ íŒŒì‹±í•´ì„œ í• ì¸ ê³„ì‚° ë‹¨ê³„ë¡œ ë„˜ì–´ê°

---

### âœ… ìš”ê¸ˆì œëª… or ê°€ê²© ë§¤í•‘ ì²˜ë¦¬

```js
if (args.planNames && Array.isArray(args.planNames)) {
  prices = args.planNames
    .map(findClosestPlanPrice) // testPlans ì—ì„œ price ê°€ì ¸ì˜´
    .filter((p) => p !== null);
}
else if (args.planPrices && Array.isArray(args.planPrices)) {
  prices = args.planPrices
    .map((p) => parseInt(p, 10))
    .filter((p) => !isNaN(p));
}
```

â†’ GPTê°€ `planNames` ë¡œ ìš”ê¸ˆì œëª…ì„ ì£¼ëŠ” ê²½ìš°ë„ ìˆê³ , `planPrices` ë¡œ ìˆ«ìë¥¼ ì£¼ëŠ” ê²½ìš°ë„ ìˆìŒ
â†’ ë‘ ê°€ì§€ ëª¨ë‘ ëŒ€ì‘í•  ìˆ˜ ìˆë„ë¡ ë¶„ê¸° ì²˜ë¦¬

---

### âœ… `findClosestPlanPrice()` í•¨ìˆ˜ ì„¤ê³„ ì˜ë„

```js
function findClosestPlanPrice(planName) {
  const exactMatch = testPlans.find((p) => planName.includes(p.name));
  ...
  const aliasMatch = testPlans.find((p) =>
    p.alias?.some((alias) =>
      lowerInput.includes(alias.toLowerCase().replace(/\s/g, ""))
    )
  );
}
```

â†’ ì‚¬ìš©ìê°€ ì…ë ¥í•œ ìš”ê¸ˆì œëª…ì´ ì •í™•í•˜ì§€ ì•Šê±°ë‚˜ ë„ì–´ì“°ê¸° ì˜¤ë¥˜ê°€ ìˆì–´ë„
â†’ **ìœ ì‚¬í•œ alias ë§¤ì¹­ìœ¼ë¡œ ìµœëŒ€í•œ ê°€ê²©ì„ ì°¾ì•„ë‚¼ ìˆ˜ ìˆë„ë¡ ì„¤ê³„**
â†’ ì‹¤ì œ ìƒë‹´ ì‹œ ì‚¬ìš©ìê°€ ì…ë ¥í•˜ëŠ” í…ìŠ¤íŠ¸ê°€ ê¹¨ë—í•˜ì§€ ì•Šì€ ê²½ìš°ê°€ ë§ê¸° ë•Œë¬¸ì— robustí•œ ë§¤ì¹­ ë¡œì§ í•„ìš”

---

### âœ… í• ì¸ ê³„ì‚° í›„ ìµœì¢… ì‘ë‹µ íë¦„

```js
const result = calculateFamilyBundle(prices);

const finalResponse = await openai.chat.completions.create({
  model: "gpt-4.1-mini",
  messages: [
    ...messages,
    {
      role: "function",
      name: "calculateFamilyBundleDiscount",
      content: JSON.stringify(result),
    },
  ],
});
res.send(finalResponse.choices[0].message.content);
```

â†’ í• ì¸ ê³„ì‚° í›„, **function ì‘ë‹µì„ GPTì— ë‹¤ì‹œ ë„˜ê²¨ì„œ ìì—°ì–´ë¡œ í‘œí˜„í•˜ê²Œ êµ¬ì„±**
â†’ GPTê°€ ìµœì¢…ì ìœ¼ë¡œ ì‚¬ìš©ìê°€ ì½ê¸° ì‰¬ìš´ í˜•íƒœë¡œ ì‘ë‹µì„ ì™„ì„±
â†’ ex) "3íšŒì„  ê¸°ì¤€ ì´ 17,600ì›ì˜ í• ì¸ì´ ì ìš©ë©ë‹ˆë‹¤!"

---

### âœ… ì „ì²´ ì„¤ê³„ í¬ì¸íŠ¸

| í¬ì¸íŠ¸              | ì„¤ëª…                                   |
| ---------------- | ------------------------------------ |
| Function Calling | ì •í™•í•œ ê³„ì‚°ì´ í•„ìš”í•œ ë¶€ë¶„ê³¼ GPTì˜ ììœ ë¡œìš´ ì‘ë‹µì„ ì ì ˆíˆ ë¶„ë¦¬ |
| Robust ë§¤ì¹­        | ì‚¬ìš©ìì˜ ì…ë ¥ ë³€í˜•ì— ëŒ€ì‘í•˜ëŠ” ìœ ì‚¬ë„ ë§¤ì¹­ ë¡œì§           |
| ì„ ì²˜ë¦¬ ë£°            | íŒ¨í„´ ë§¤ì¹­ìœ¼ë¡œ ê°„ë‹¨í•œ ì§ˆë¬¸ì€ ë¹ ë¥´ê²Œ ëŒ€ì‘               |
| Modular êµ¬ì¡°       | í• ì¸ ë¡œì§/ìŠ¤í‚¤ë§ˆ/API ìš”ì²­ë¶€ê°€ ëª…í™•íˆ ëª¨ë“ˆí™”ë¨          |
| ëŒ€í™” ê¸°ë¡ ìœ ì§€         | ì´ì „ messages ì „ì²´ historyë¥¼ ìœ ì§€í•˜ë©° ì»¨í…ìŠ¤íŠ¸ ë°˜ì˜ |

---

### âœ… ê°œì¸ì ì¸ ëŠë‚€ ì 

* `gpt-4.1-mini` ëª¨ë¸ì´ë¼ë„ Function Callingì´ ì˜ ë™ì‘í•´ì„œ ê·œì¹™ ê¸°ë°˜ ê³„ì‚°ì´ ë§¤ìš° ì•ˆì •ì ìœ¼ë¡œ ì—°ê²° ê°€ëŠ¥
* ê¸°ì¡´ ë£° ê¸°ë°˜ ì±—ë´‡ë³´ë‹¤ í›¨ì”¬ ìì—°ìŠ¤ëŸ¬ìš´ UX êµ¬í˜„ ê°€ëŠ¥
* Function arguments ë§¤í•‘ì—ì„œ GPTê°€ ê°€ë” ë¶ˆì™„ì „í•œ argumentsë¥¼ ì£¼ëŠ” ê²½ìš°ê°€ ìˆì–´ì„œ, fallbackì´ë‚˜ validation ë¡œì§ì„ ì¢€ ë” ê°•í™”í•˜ë©´ ì¢‹ê² ë‹¤ëŠ” ê°œì„  í¬ì¸íŠ¸ë„ ë°œê²¬

----

ğŸ”¸ í”„ë¡ íŠ¸ì—”ë“œ ì±— UI êµ¬ì„± - `frontend/components/ChatBox.jsx`

```jsx
const [messages, setMessages] = useState([]);
const res = await fetch("http://localhost:5001/api/gpt/chat", {
  method: "POST",
  headers: { "Content-Type": "application/json" },
  body: JSON.stringify({ messages: newMessages }),
});
const data = await res.text();
setMessages([...newMessages, { role: "assistant", content: data }]);
```

âœ… Reactì—ì„œ ê°„ë‹¨í•œ chat history êµ¬ì„±      
âœ… ì‚¬ìš©ìê°€ ë©”ì‹œì§€ ì…ë ¥ ì‹œ ì„œë²„ì— ê¸°ì¡´ messages ë°°ì—´ê³¼ í•¨ê»˜ ì „ë‹¬       
âœ… ì„œë²„ ì‘ë‹µì„ ë°›ì•„ chat ì°½ì— append       
âœ… loading í‘œì‹œ ì¶”ê°€       

---

# ğŸ–¼ï¸ ì‘ì—… ê²°ê³¼ë¬¼

<img src="/assets/post/2025/ureca/day95_proj_2.png" alt='' width=1300px>
<img src="/assets/post/2025/ureca/day95_proj_3.png" alt='' width=1300px>

---

# âœ… ê²°ê³¼ ë° ëŠë‚€ ì 

* GPT Function Callingì„ í™œìš©í•˜ë©´ ê·œì¹™ ê¸°ë°˜ ê³„ì‚°ê³¼ ìì—°ì–´ ì‘ë‹µì„ íš¨ê³¼ì ìœ¼ë¡œ ê²°í•©í•  ìˆ˜ ìˆë‹¤ëŠ” ì ì„ ê²½í—˜
* ê¸°ì¡´ ë‹¨ìˆœ í…ìŠ¤íŠ¸ í”„ë¡¬í”„íŠ¸ ê¸°ë°˜ë³´ë‹¤ëŠ” ì‹ ë¢°ë„ ë†’ì€ í• ì¸ ê³„ì‚°ì´ ê°€ëŠ¥
* React ê°„ë‹¨í•œ ì±— UIë¥¼ í†µí•´ ë¹ ë¥´ê²Œ í”„ë¡œí† íƒ€ì´í•‘ ê°€ëŠ¥
* GPT-4.1-miniì˜ ì‘ë‹µ ì†ë„ê°€ ìƒê°ë³´ë‹¤ ë¹¨ë¼ ì‹¤ì‹œê°„ ìƒë‹´í˜• UXì—ë„ ì ìš© ê°€ëŠ¥ì„±ì„ í™•ì¸

---

# Reference

* [OpenAI GPT Function Calling ê³µì‹ ë¬¸ì„œ](https://platform.openai.com/docs/guides/function-calling)
* [LG U+ ê³µì‹ ìš”ê¸ˆì œ ì•ˆë‚´](https://www.lguplus.com/plan)

---

## END

