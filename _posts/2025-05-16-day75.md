---
title: "[GitPulse #6] ì»¤ë°‹ ì»¨ë²¤ì…˜ ìë™ ê²€ì‚¬ & PR ë¦¬ë·° ì¸í„°í˜ì´ìŠ¤"
categories: [Ureca, Project]
tags: [React, JS, Express, MongoDB, React Query]
image:
  path: /assets/post/2025/ureca/gitpulse.png
  alt: project
published: true
---

# âœ… ì˜¤ëŠ˜ì˜ ëª©í‘œ

- [x] ì»¤ë°‹ ë©”ì‹œì§€ ì»¨ë²¤ì…˜ ìë™ ê²€ì‚¬ ê¸°ëŠ¥ ë„ì…
- [x] GitHub PR ë¦¬ë·°ë¥¼ ìœ„í•œ diff ê¸°ë°˜ ì¸í„°í˜ì´ìŠ¤ êµ¬í˜„
- [x] PR ìƒì„¸ í˜ì´ì§€ ì´ë™ ì‹œ `state` ê¸°ë°˜ ë°ì´í„° ì „ë‹¬ êµ¬ì¡° ê°œì„ 

---

# ğŸ§© ë¬¸ì œ ìƒí™© / ë°°ê²½

- í˜‘ì—… ì¤‘ ì»¤ë°‹ ë©”ì‹œì§€ ì»¨ë²¤ì…˜(feat/fix ë“±)ì„ ë„ì…í–ˆì§€ë§Œ, íŒ€ì›ë§ˆë‹¤ ì¼ê´€ë˜ì§€ ì•Šì•„ ë¦¬ë·° í’ˆì§ˆê³¼ ì´ë ¥ ì¶”ì ì— ì–´ë ¤ì›€ì´ ë°œìƒí–ˆìŠµë‹ˆë‹¤. ì´ë¥¼ í•´ê²°í•˜ê¸° ìœ„í•´ ì»¤ë°‹ ë©”ì‹œì§€ì— ëŒ€í•œ ìë™ ê²€ì‚¬ ê¸°ëŠ¥ì´ í•„ìš”í–ˆìŠµë‹ˆë‹¤.
- PR ë¦¬ë·° ê¸°ëŠ¥ì˜ ì´ˆê¸° êµ¬í˜„ì—ì„œëŠ” GitHubì˜ diff ì •ë³´ë¥¼ ë‹¨ìˆœíˆ stringìœ¼ë¡œ ì¶œë ¥í–ˆê¸° ë•Œë¬¸ì—, ì¤„ ë‹¨ìœ„ ì¸í„°ë™ì…˜ì´ë‚˜ ëŒ“ê¸€ ì‘ì„±ì´ ë¶ˆê°€ëŠ¥í–ˆê³ , ì‹œê°ì ìœ¼ë¡œë„ ë¶ˆí¸í–ˆìŠµë‹ˆë‹¤.
- PR ìƒì„¸ í˜ì´ì§€ë¡œ ì´ë™í•  ë•Œ í•„ìš”í•œ ì •ë³´ë¥¼ URL íŒŒì‹±ì—ë§Œ ì˜ì¡´í•˜ë‹¤ ë³´ë‹ˆ, ìœ ì§€ë³´ìˆ˜ì— ì·¨ì•½í•˜ê³  ì½”ë“œ ê°€ë…ì„±ë„ ë–¨ì–´ì¡ŒìŠµë‹ˆë‹¤.

---

# ğŸ› ï¸ í•´ê²° ê³¼ì • / ì½”ë“œ ì •ë¦¬

## ğŸ”¸ ì»¤ë°‹ ë©”ì‹œì§€ ì»¨ë²¤ì…˜ ì˜¤ë¥˜ ê²€ì‚¬ ì»´í¬ë„ŒíŠ¸

#### âœ… ê²€ì‚¬ ì•Œê³ ë¦¬ì¦˜ íë¦„
1. ì»¤ë°‹ ë©”ì‹œì§€ë¥¼ ì •ê·œí™” (`normalizeMessage`) â€” ì†Œë¬¸ìë¡œ í†µì¼, ê³µë°± ì œê±°
2. `merge` ì»¤ë°‹ì€ ì˜ˆì™¸ë¡œ ì²˜ë¦¬ (ê²€ì‚¬ ì œì™¸)
3. ì •ê·œí™”ëœ ë©”ì‹œì§€ê°€ ì •í•´ì§„ ì ‘ë‘ì–´ë¡œ ì‹œì‘í•˜ì§€ ì•Šìœ¼ë©´ ì˜¤ë¥˜ ì‚¬ìœ  ì¶”ê°€
4. ë©”ì‹œì§€ ê¸¸ì´ê°€ 6ì ë¯¸ë§Œì´ë©´ ë˜ ë‹¤ë¥¸ ì˜¤ë¥˜ ì‚¬ìœ  ì¶”ê°€
5. ì˜¤ë¥˜ê°€ ìˆëŠ” ì»¤ë°‹ë§Œ í•„í„°ë§í•˜ì—¬ UIì— í‘œì‹œ

```js
const ConventionError = ({ commits }) => {
  // í—ˆìš©ë˜ëŠ” ì ‘ë‘ì–´
  const allowedPrefixes = [
    "feat", "fix", "bug", "style", "refactor", "test", "chore", "docs",
  ];

  // merge ì»¤ë°‹ ì—¬ë¶€ í™•ì¸
  const isMergeCommit = (message) => message.toLowerCase().startsWith("merge");

  // ë©”ì‹œì§€ë¥¼ ì†Œë¬¸ìë¡œ ë°”ê¾¸ê³ , ê³µë°± ì œê±°
  const normalizeMessage = (msg) =>
    msg.trim().toLowerCase().replace(/\s+/g, ""); // ì—¬ëŸ¬ ê³µë°±ì„ í•˜ë‚˜ë¡œ ì••ì¶• í›„ ì œê±°

  // ì»¨ë²¤ì…˜ ì˜¤ë¥˜ íŒë‹¨
  const isConventionError = (message) => {
    const reasons = [];
    if (isMergeCommit(message)) return { reasons: [] };
    
    const normalized = normalizeMessage(message);
    const hasPrefix = allowedPrefixes.some((prefix) =>
      normalized.startsWith(prefix)
    );

    if (!hasPrefix)
      reasons.push(
        "ì»¤ë°‹ ë©”ì‹œì§€ì— ì ‘ë‘ì–´(feat, fix ë“±)ê°€ ë¹ ì¡ŒìŠµë‹ˆë‹¤. ì»¨ë²¤ì…˜ì„ ì§€ì¼œì£¼ì„¸ìš”"
      );
    if (normalized.length < 6)
      reasons.push("ì»¤ë°‹ ë©”ì‹œì§€ê°€ ë„ˆë¬´ ì§§ì•„ìš”. ì¡°ê¸ˆ ë” êµ¬ì²´ì ìœ¼ë¡œ ì ì–´ì£¼ì„¸ìš”");
    return { reasons };
  };

  // ì „ì²´ ì»¤ë°‹ ë©”ì‹œì§€ í•„í„°ë§
  const commitMsgList = commits?.map((commit) => {
    const { reasons } = isConventionError(commit.commit.message);
    return {
      date: commit.commit.author.date,
      author: commit.commit.author.name,
      message: commit.commit.message,
      result: reasons,
    };
  });
  const filteredList = commitMsgList?.filter(
    (commit) => commit.result.length > 0
  );
  return (
    <div className={css.conventionErrorCon}>
      <div className={css.tableTitle}>
        <h3>
          ì»¤ë°‹ ë©”ì„¸ì§€ <strong>ì»¨ë²¤ì…˜ ì˜¤ë¥˜</strong>
        </h3>
        <p>íŒ€ì› ê°„ í˜‘ì—…ì„ ìœ„í•´ ì»¤ë°‹ ë©”ì‹œì§€ë„ í‘œì¤€ì„ ì§€ì¼œì•¼ì£ !</p>
      </div>
      <ConventionErrTable commitMsgList={filteredList} />
    </div>
  );
};
```

------

## ğŸ”¸ PR ìƒì„¸ í˜ì´ì§€ë¡œ ì´ë™ ì‹œ `state` ì „ë‹¬ ë°©ì‹ ê°œì„ 

ê¸°ì¡´ ì½”ë“œ:

```js
const handlePrComment = (id) => {
  navigate(`/org/${orgId}/${orgs}/${id}`);
};
```

ê°œì„  ì½”ë“œ:

```js
const handlePrComment = (number, url) => {
  navigate(`/org/${orgId}/${orgs}/${number}`, {
    state: { url },
  });
};
// ...
<button onClick={() => handlePrComment(PR.number, PR.url)} />
```

ì´ë™ í›„ í˜ì´ì§€ì—ì„œ URL íŒŒì‹±:

```js
const location = useLocation();
const { url } = location.state || {};
const parts = url?.split("/");
const orgs = parts[4];
const repo = parts[5];
const pullNumber = parts[7];
```

> `navigate`ì— `state`ë¥¼ í•¨ê»˜ ë„˜ê²¨ì¤Œìœ¼ë¡œì¨, ë¶ˆí•„ìš”í•œ íŒŒì‹± ë¡œì§ì„ ìµœì†Œí™”í•˜ê³  URL ë°ì´í„°ì˜ ì˜ì¡´ì„±ì„ ì¤„ì„

### â“`state`ë¥¼ ì‚¬ìš©í•˜ëŠ” ì´ìœ 
- URLì— ëª¨ë“  ì •ë³´ë¥¼ í¬í•¨ì‹œí‚¤ëŠ” ë°©ì‹ì€ URL íŒŒì‹±ì— ì˜ì¡´í•˜ê²Œ ë˜ê³  ìœ ì§€ë³´ìˆ˜ì— ë¶ˆë¦¬
- `navigate(path, { state })`ë¥¼ ì‚¬ìš©í•˜ë©´ í•„ìš”í•œ ë°ì´í„°ë¥¼ ê°ì²´ í˜•íƒœë¡œ ëª…í™•í•˜ê²Œ ë„˜ê¸¸ ìˆ˜ ìˆì–´ ê°€ë…ì„±, ì•ˆì •ì„±, ì¬ì‚¬ìš©ì„± í–¥ìƒ
- ë°›ì€ ì»´í¬ë„ŒíŠ¸ì—ì„œëŠ” `useLocation()`ìœ¼ë¡œ `state` ê°’ì„ ì•ˆì „í•˜ê²Œ ì¶”ì¶œ ê°€ëŠ¥

-----

## ğŸ”¸ PR ë³€ê²½ íŒŒì¼ UI êµ¬ì„± ë° ë¦¬ë·° ì¸í„°ë™ì…˜ ì²˜ë¦¬

PR ìƒì„¸ í˜ì´ì§€ì—ì„œëŠ” GitHub APIì—ì„œ ì œê³µí•˜ëŠ” íŒŒì¼ ë³€ê²½ ì •ë³´ (`files`)ë¥¼ ë°›ì•„, ë‹¤ìŒê³¼ ê°™ì€ ë°©ì‹ìœ¼ë¡œ UIì— ë³´ì—¬ì£¼ë„ë¡ êµ¬ì„±

### âœ… `usePRInfo`ë¥¼ í†µí•´ íŒŒì¼ ë³€ê²½ ì •ë³´ ê°€ì ¸ì˜¤ê¸°

```js
const { data, isLoading, isError } = usePRInfo(orgs, repo, pullNumber);
const prFiles = data?.files;
```

ì‘ë‹µ ë°ì´í„° ì˜ˆì‹œ (`file.patch` í¬í•¨):

<img src="/assets/post/2025/ureca/day75_project_1.png" alt='' width="1300px" />

```json
{
  "filename": "frontend/src/common/SideBar.jsx",
  "status": "modified",
  "additions": 67,
  "deletions": 61,
  "changes": 128,
  "patch": "@@ -3,89 +3,95 @@ import css from ...\n-  const navigate = useNavigate();\n+  ..."
}
```

### âœ… patch ë°ì´í„° ê¸°ë°˜ UI ë Œë”ë§ ë¡œì§

- ë³€ê²½ëœ íŒŒì¼ì˜ patch ë‚´ìš©ì„ ì¶”ê°€/ì‚­ì œ/ë³€ê²½ ë¼ì¸ì„ ì‹œê°ì ìœ¼ë¡œ êµ¬ë¶„
- ê° ì¤„ì— ë¦¬ë·°ê°€ ìˆëŠ” ê²½ìš°, ì•„ì´ì½˜ ë° ë¦¬ë·° ë“±ë¡ ê¸°ëŠ¥ ì¶”ê°€

â‘  `patch` ë¬¸ìì—´ì„ \n ê¸°ì¤€ìœ¼ë¡œ í•œ ì¤„ì”© ìª¼ê°  ë‹¤ìŒ `.map()`ìœ¼ë¡œ í•˜ë‚˜ì”© <div>ì— ë‹´ì•„ì„œ ê·¸ë ¤ì¤€ë‹¤.

- `file.patch`ëŠ” GitHub APIì—ì„œ ì œê³µí•˜ëŠ” "íŒŒì¼ ë³€ê²½ ë‚´ìš©(diff)" ë¬¸ìì—´
- ì¤„ë°”ê¿ˆ ê¸°ì¤€ìœ¼ë¡œ ë¶„ë¦¬í•˜ë©´, ì½”ë“œ í•œ ì¤„ì”© ë³€ê²½ ë‚´ìš©ì„ ì•Œ ìˆ˜ ìˆìŒ

```js
file?.patch?.split("\n").map((line, lineIndex) => {
  return (
    <div key={lineIndex}>
      {/* í•œ ì¤„ì˜ ì½”ë“œ ì •ë³´ */}
    </div>
  )
})
```

ì˜ˆë¥¼ ë“¤ì–´ `patch`ê°€ ì´ëŸ° ì‹ì´ë©´:

```diff
@@ -3,89 +3,95 @@
-import { A }
+import { B }
 const x = 1;
```

â‘ ì„ ê±°ì¹˜ë©´ ê° ì¤„ì„ `<div>`ë¡œ ê°ì‹¸ì„œ ë³´ì—¬ì¤Œ

* `<div>@@ -3,89 +3,95 @@</div>`
* `<div>-import { A }</div>`
* `<div>+import { B }</div>`
* `<div> const x = 1</div>`

ì´ëŸ° ì‹ìœ¼ë¡œ ì¶œë ¥

---

### â‘¡ ê° ì¤„ì˜ ì¢…ë¥˜ë¥¼ íŒë‹¨í•´ì„œ ìƒ‰ì„ ì…íŒë‹¤

```js
if (line.startsWith("+") && !line.startsWith("+++")) {
  ë°°ê²½: ì—°í•œ ì´ˆë¡ìƒ‰
} else if (line.startsWith("-") && !line.startsWith("---")) {
  ë°°ê²½: ì—°í•œ ë¹¨ê°„ìƒ‰
} else if (line.startsWith("@@")) {
  ë°°ê²½: íšŒìƒ‰ (ë©”íƒ€ì •ë³´)
}
```

| ì¤„ ë‚´ìš©         | ìƒ‰ìƒ    |
| ------------ | ----- |
| `+ import B` | ì—°í•œ ì´ˆë¡ |
| `- import A` | ì—°í•œ ë¹¨ê°• |
| `@@ ...`     | íšŒìƒ‰    |
| `ê¸°íƒ€ ì½”ë“œ`      | ê¸°ë³¸ìƒ‰   |

---

### â‘¢ ì¤„ ë²ˆí˜¸ì™€ ğŸ’œ ëŒ“ê¸€ ì•„ì´ì½˜

```js
{lineIndex + 1}
{commentsForLine.length > 0 && <span>ğŸ’œ</span>}
```

ì¤„ ë²ˆí˜¸ëŠ” 1ë¶€í„° ì‹œì‘í•´ì„œ ë³´ì—¬ì£¼ê³ , í•´ë‹¹ ì¤„ì— ë¦¬ë·° ëŒ“ê¸€ì´ ë‹¬ë ¤ ìˆìœ¼ë©´ ğŸ’œ ì•„ì´ì½˜ì„ ê°™ì´ ë³´ì—¬ì¤Œ.

---

### â‘£ ì¤„ í´ë¦­ ì‹œ ëŒ“ê¸€ ì…ë ¥ì°½ ì—´ê¸°

```js
onClick={() => {
  if (isAddedLine) {
    setExpandedLines((prev) => ({
      ...prev,
      [key]: !prev[key],
    }));
  }
}}
```

* `+`ë¡œ ì‹œì‘í•˜ëŠ” ì¤„ë§Œ í´ë¦­ ê°€ëŠ¥í•˜ê²Œ í•´ì„œ í´ë¦­í•˜ë©´ ì¤„ ì•„ë˜ìª½ì— ëŒ“ê¸€ ëª©ë¡ + ëŒ“ê¸€ ì…ë ¥ì°½ì„ ë³´ì—¬ì¤Œ


### ì „ì²´ íë¦„ ì •ë¦¬ ê·¸ë¦¼

```plaintext
patch (string)
  â†“ split("\n")
[ line1, line2, ... ]
  â†“ map()
<pre>
  <div>ì¤„ 1: ìƒ‰ìƒ ì…í˜ + ì¤„ë²ˆí˜¸ + ì¤„ë‚´ìš© + ëŒ“ê¸€í† ê¸€</div>
  <div>ì¤„ 2: ...</div>
  ...
</pre>
```

> ì½”ë“œ í˜•ì‹ì„ ìœ ì§€í•˜ê¸° ìœ„í•´ ì „ì²´ë¥¼ `<pre>`ë¡œ ê°ì‹¸ í…ìŠ¤íŠ¸ ì¤„ë°”ê¿ˆ/ë“¤ì—¬ì“°ê¸°ë¥¼ ìœ ì§€í•œë‹¤.

#### ì „ì²´ ì½”ë“œ
```js
<pre className={css.codeBlock}>
  {file?.patch?.split("\n").map((line, lineIndex) => {
    const key = `${file.filename}-${lineIndex}`;

    // ì¤„ êµ¬ë¶„ ìƒ‰ìƒ ì²˜ë¦¬
    const isAddedLine = line.startsWith("+") && !line.startsWith("+++");
    const isRemovedLine = line.startsWith("-") && !line.startsWith("---");
    const isMetaLine = line.startsWith("@@");

    // ì‹œê° ìŠ¤íƒ€ì¼ ì„¤ì •
    let bgColor = "";
    let color = "";
    if (isAddedLine) {
      bgColor = "#e6ffed";
      color = "#22863a";
    } else if (isRemovedLine) {
      bgColor = "#ffeef0";
      color = "#cb2431";
    } else if (isMetaLine) {
      bgColor = "#f0f0f0";
      color = "#6a737d";
    }

    const commentsForLine = getCommentsForLine(
      file.filename,
      lineIndex,
      file.patch,
      reviewComments
    );

    return (
      <div
        key={lineIndex}
        className={css.codeLineWrapper}
        style={{
          backgroundColor: bgColor,
          color,
          display: "flex",
          padding: "2px 0",
          flexDirection: "column",
        }}
      >
        {/* ì¤„ ë²ˆí˜¸ ë° ì½”ë“œ */}
        <div style={{ display: "flex", width: "100%" }}>
          <div style={{ paddingLeft: "8px", paddingRight: "8px", textAlign: "right", color: "#999" }}>
            {lineIndex + 1}
            {commentsForLine.length > 0 && <span className={css.isComment}>ğŸ’œ</span>}
          </div>
          <div
            style={{ flex: 1, whiteSpace: "pre-wrap", cursor: isAddedLine ? "pointer" : "default" }}
            onClick={() => {
              if (isAddedLine) {
                setExpandedLines((prev) => ({
                  ...prev,
                  [key]: !prev[key],
                }));
              }
            }}
          >
            {line}
          </div>
        </div>

        {/* ì¤„ ëŒ“ê¸€ ì˜ì—­ (ì—´ë ¸ì„ ë•Œë§Œ í‘œì‹œ) */}
        {expandedLines[key] && (
          <div style={{ marginLeft: "50px", marginTop: "4px" }}>
            {commentsForLine.map((cmt, i) => (
              <div key={i} className={css.commentBody}>
                <div className={css.commentInfo}>
                  <div className={css.commentUser}>{cmt.user.login}</div>
                  <div>{cmt.created_at.split("T")[0]}</div>
                </div>
                <div className={css.lineBody}>{cmt.body}</div>
              </div>
            ))}

            {/* ëŒ“ê¸€ ì‘ì„± */}
            <div className={css.lineComment}>
              <LineCommentInput
                value={commentTargets[key]}
                onChange={(val) => handleCommentChange(key, val)}
              />
              <button
                onClick={async () => {
                  const body = commentTargets[key];
                  const position = getPositionInPatch(file.patch, lineIndex);
                  if (!commitId || position === null) {
                    alert("ì»¤ë°‹ ID ë˜ëŠ” positionì´ ìœ íš¨í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤.");
                    return;
                  }
                  await postPRComment(
                    orgs,
                    repo,
                    pullNumber,
                    body,
                    commitId,
                    file.filename,
                    position
                  );
                  await refetchReviewComments();
                  handleCommentChange(key, undefined);
                }}
              >
                ë¦¬ë·° ë“±ë¡
              </button>
            </div>
          </div>
        )}
      </div>
    );
  })}
</pre>
```

----

# âœ… ê²°ê³¼ ë° ëŠë‚€ ì 

- ì»¤ë°‹ ë©”ì‹œì§€ ì»¨ë²¤ì…˜ ì˜¤ë¥˜ë¥¼ ì‹œê°ì ìœ¼ë¡œ ë³´ì—¬ì£¼ê³  ìë™ìœ¼ë¡œ ê°ì§€í•  ìˆ˜ ìˆì–´, ë¦¬ë·° í’ˆì§ˆ ë° íŒ€ ì»¤ë®¤ë‹ˆì¼€ì´ì…˜ì˜ ì¼ê´€ì„±ì´ ë†’ì•„ì¡ŒìŠµë‹ˆë‹¤.
- patch ê¸°ë°˜ ì½”ë“œ diff ì¸í„°í˜ì´ìŠ¤ êµ¬í˜„ì„ í†µí•´ íŒ€ì›ë“¤ì´ ì¤„ ë‹¨ìœ„ë¡œ ì½”ë“œë¥¼ ë¦¬ë·°í•˜ê³  ì˜ê²¬ì„ ë‚˜ëˆ„ëŠ” ë° ìˆì–´ ì‚¬ìš©ì„±ê³¼ ì§ê´€ì„±ì´ í¬ê²Œ í–¥ìƒë˜ì—ˆìŠµë‹ˆë‹¤.
- React Routerì˜ `navigate`ì— `state`ë¥¼ í™œìš©í•˜ë©´ì„œ, URL íŒŒì‹±ì˜ ë³µì¡ë„ëŠ” ì¤„ì´ê³  êµ¬ì¡°ì ìœ¼ë¡œ ë” ì•ˆì „í•œ ë°ì´í„° ì „ë‹¬ì´ ê°€ëŠ¥í•´ì¡ŒìŠµë‹ˆë‹¤.

---

# ğŸ–¼ï¸ ì‘ì—… ê²°ê³¼ë¬¼

### ì»¤ë°‹ ë©”ì‹œì§€ ì»¨ë²¤ì…˜ ìë™ ê²€ì‚¬
<img src="/assets/post/2025/ureca/day75_project_3.png" alt='' width="1300px" />

### GitHub PR ë¦¬ë·°ë¥¼ ìœ„í•œ diff ê¸°ë°˜ ì¸í„°í˜ì´ìŠ¤
<img src="/assets/post/2025/ureca/day75_project_2.png" alt='' width="1300px" />

---

## Reference

- [React Router - useNavigate, useLocation ê³µì‹ ë¬¸ì„œ](https://reactrouter.com/en/main/hooks/use-navigate)
- [Git ì»¤ë°‹ ë©”ì‹œì§€ ì»¨ë²¤ì…˜ ê°€ì´ë“œ (Conventional Commits)](https://www.conventionalcommits.org/)

---

## END