---
title: "[Day34] ì‡¼í•‘ëª° ì‹¤ìŠµ - JWT ì•”í˜¸í™”"
categories: [Ureca, Spirng]
tags: [Spirng, JWT]
image:
  path: /assets/post/2025/ureca/day33_class_1.png
  alt: spring
published: true
---

# Hash & Salt

### Salt : ì‚¬ìš©ìë§ˆë‹¤ ê³ ìœ í•œ ë‚œìˆ˜ë¥¼ ìƒì„±í•˜ì—¬ í•´ì‹±í•  ë•Œ ì¶”ê°€
### Hashing : ë‹¨ë°©í–¥ ì•”í˜¸í™” ë°©ì‹ìœ¼ë¡œ ì €ì¥ëœ ë¹„ë°€ë²ˆí˜¸ë¥¼ ë³´í˜¸

- ëª©ì : ë°ì´í„° ë¬´ê²°ì„± ê²€ì¦ ë° ë³´ì•ˆì„ ìœ„í•´ í•´ì‹œ ê°’ì— ì¶”ê°€ì ì¸ ë¬´ì‘ìœ„ ë°ì´í„°(Salt)ë¥¼ ë”í•˜ëŠ” ê²ƒ
<br/>
- í•´ì‹œëŠ” ì£¼ì–´ì§„ ë°ì´í„°ë¥¼ ê³ ì •ëœ ê¸¸ì´ì˜ ê°’ìœ¼ë¡œ ë³€í™˜í•˜ëŠ” ë°©ì‹  
- ê°™ì€ ì…ë ¥ê°’ì´ë©´ í•­ìƒ ê°™ì€ í•´ì‹œê°’ì´ ë‚˜ì˜¤ë©°, ì´ë¥¼ í†µí•´ ë°ì´í„°ê°€ ë³€ì¡°ë˜ì§€ ì•Šì•˜ìŒì„ í™•ì¸í•  ìˆ˜ ìˆìŒ  
- **ë¹„ë°€ë²ˆí˜¸ ì €ì¥** ì‹œ ì£¼ë¡œ ì‚¬ìš©ë˜ë©°, ì§ì ‘ ë¹„ë°€ë²ˆí˜¸ë¥¼ ì €ì¥í•˜ì§€ ì•Šê³  í•´ì‹œ ê°’ì„ ì €ì¥í•¨  
- ë¹„ë°€ë²ˆí˜¸ë¥¼ í•´ì‹±í•˜ë©´ ì›ë˜ ê°’ìœ¼ë¡œ ë³µì›í•  ìˆ˜ ì—†ìŒ(ë‹¨ë°©í–¥ ì•”í˜¸í™”)  
<br/>

ğŸ’¡ ë‹¨ìˆœ í•´ì‹±ì€ ê°™ì€ ì…ë ¥ê°’ì´ë©´ í•­ìƒ ê°™ì€ í•´ì‹œ ê°’ì´ ë‚˜ì™€ì„œ Brute Force Attackì´ë‚˜ ë ˆì¸ë³´ìš° í…Œì´ë¸” ê³µê²©(Rainbow Table Attack)ì— ì·¨ì•½í•¨

---

## ë°±ì—”ë“œ (BACK)

### ğŸ“Œ Salt ì €ì¥ í…Œì´ë¸” ìƒì„± (MySQL)
```sql
DROP TABLE IF EXISTS saltInfo;

CREATE TABLE saltInfo (
    email VARCHAR(50) PRIMARY KEY,
    salt VARCHAR(256)
);
```

### ğŸ“Œ DTO: `SaltInfo.java`
```java
public class SaltInfo {
	private String email, salt;

	public String getEmail() { return email; }
	public void setEmail(String email) { this.email = email; }

	public String getSalt() { return salt; }
	public void setSalt(String salt) { this.salt = salt; }

	public SaltInfo(String email, String salt) {
		super();
		this.email = email;
		this.salt = salt;
	}
	public SaltInfo() { super(); }
	@Override
	public String toString() {
		return "SaltInfo [email=" + email + ", salt=" + salt + "]";
	}
}
```

### ğŸ“Œ DAO: `SaltDao.java`
```java
import org.apache.ibatis.annotations.Mapper;
import com.shop.cafe.dto.SaltInfo;

@Mapper
public interface SaltDao {
	public void insertSalt(SaltInfo saltInfo) throws Exception;
	public SaltInfo selectSalt(String email) throws Exception;
}
```
- `insertSalt(SaltInfo saltInfo)`: salt ì €ì¥
- `selectSalt(String email)`: íŠ¹ì • emailì— ëŒ€í•œ salt ì¡°íšŒ


### ğŸ“Œ MyBatis ë§¤í•‘ : `salt.xml`
```xml
<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "https://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.shop.cafe.dao.SaltDao">

  <insert id="insertSalt" parameterType="SaltInfo">
    INSERT INTO saltInfo (email, salt) VALUES (#{email}, #{salt})
  </insert>

  <select id="selectSalt" parameterType="String" resultType="SaltInfo">
    SELECT * FROM saltInfo WHERE email=#{email}
  </select>

</mapper>
```

### ğŸ“Œ ì„œë¹„ìŠ¤ ë¡œì§: `MemberService.java`

#### âœ… íšŒì› ê°€ì… ì‹œ íŒ¨ìŠ¤ì›Œë“œ í•´ì‹± í›„ ì €ì¥

```java
public void insertMember(Member m) throws Exception {
    // ì´ë©”ì¼ ìœ íš¨ì„± ê²€ì‚¬
    String email = m.getEmail();
    if (!isValidEmail(email)) {
        throw new Exception("ìœ íš¨í•˜ì§€ ì•Šì€ ì´ë©”ì¼ í˜•ì‹ì…ë‹ˆë‹¤.");
    }

    // íŒ¨ìŠ¤ì›Œë“œ ìœ íš¨ì„± ê²€ì‚¬
    String pwd = m.getPwd();
    if (!isValidPassword(pwd)) {
        throw new Exception("íŒ¨ìŠ¤ì›Œë“œëŠ” 8ìë¦¬ ì´ìƒì´ì–´ì•¼ í•˜ë©°, íŠ¹ìˆ˜ë¬¸ìì™€ ìˆ«ìë¥¼ í¬í•¨í•´ì•¼ í•©ë‹ˆë‹¤.");
    }
    // íŒ¨ìŠ¤ì›Œë“œ ì•”í˜¸í™”
    // 1. Salt ìƒì„±
    String salt = UUID.randomUUID().toString();
    System.out.println("salt: " + salt);

    // 2. ë¹„ë°€ë²ˆí˜¸ í•´ì‹± (SHA-256 + Salt ì ìš©)
    byte[] originalHash = OpenCrypt.getSHA256(pwd, salt);
    
    // 3. í•´ì‹±ëœ ë¹„ë°€ë²ˆí˜¸ë¥¼ Hexë¡œ ë³€í™˜ (dbì— ì €ì¥í•˜ê¸° ì¢‹ì€ í¬ë§·)
    String pwdHash = OpenCrypt.byteArrayToHex(originalHash);
    System.out.println("pwdHash: " + pwdHash);

    // 4. Salt ë° í•´ì‹±ëœ ë¹„ë°€ë²ˆí˜¸ ì €ì¥
    m.setPwd(pwdHash);
    saltDao.insertSalt(new SaltInfo(email, salt));
    memberDao.insertMember(m);
}
```

#### âœ… ì´ë©”ì¼ ìœ íš¨ì„± ê²€ì‚¬ ë©”ì„œë“œ

```java
private boolean isValidEmail(String email) {
    // ì´ë©”ì¼ íŒ¨í„´
    String emailPattern = "^[a-zA-Z0-9._%+-]+@[a-zA-Z0-9.-]+\\.[a-zA-Z]{2,}$";
    return Pattern.matches(emailPattern, email);
}

// íŒ¨ìŠ¤ì›Œë“œ ìœ íš¨ì„± ê²€ì‚¬ ë©”ì„œë“œ
private boolean isValidPassword(String password) {
    // íŒ¨ìŠ¤ì›Œë“œ íŒ¨í„´: 8ìë¦¬ ì´ìƒ, ìˆ«ì í¬í•¨, íŠ¹ìˆ˜ë¬¸ì í¬í•¨
    String passwordPattern = "^(?=.*[0-9])(?=.*[!@#$%^&*()_+\\-=\\[\\]{};':\"\\\\|,.<>\\/?]).{8,}$";
    return Pattern.matches(passwordPattern, password);
}
```

#### âœ… ë¡œê·¸ì¸ ì‹œ ë™ì¼í•œ í•´ì‹±ì„ ìˆ˜í–‰í•˜ì—¬ ì €ì¥ëœ ê°’ê³¼ ë¹„êµ

```java
public Login tokenLogin(Member m) throws Exception {
    String email = m.getEmail();
    
    // 1. DBì—ì„œ í•´ë‹¹ emailì˜ salt ì¡°íšŒ
    SaltInfo saltInfo = saltDao.selectSalt(email);
    // 2. ì…ë ¥í•œ ë¹„ë°€ë²ˆí˜¸ + saltë¡œ ë‹¤ì‹œ í•´ì‹±
    String pwd = m.getPwd();
    byte[] pwdHash = OpenCrypt.getSHA256(pwd, saltInfo.getSalt());
    String pwdHashHex = OpenCrypt.byteArrayToHex(pwdHash);
    
    // 3. í•´ì‹±ëœ ê°’ê³¼ DB ì €ì¥ê°’ ë¹„êµ
    m.setPwd(pwdHashHex);
    m = memberDao.login(m);

    if (m != null) {
        // 1.ë¡œê·¸ì¸ ì„±ê³µ ì‹œ í† í° ë°œê¸‰
        String nickname = m.getNickname();
        if(nickname!=null && !nickname.trim().equals("")) {
            //1. saltë¥¼ ìƒì„±í•œë‹¤
            String salt = UUID.randomUUID().toString();
            //2. emailì„ hashing í•œë‹¤
            byte[] originalHash = OpenCrypt.getSHA256(email, salt);
            //3. dbì— ì €ì¥í•˜ê¸° ì¢‹ì€ í¬ë§·ìœ¼ë¡œ ì¸ì½”ë”©í•œë‹¤
            String myToken = OpenCrypt.byteArrayToHex(originalHash);
            System.out.println("myToken : "+myToken);
            //4. login tableì— token ì €ì¥
            Login loginInfo = new Login(email, myToken, nickname, new Date());
            loginDao.insertToken(loginInfo);
            return loginInfo;
        }
    }
    return null;
}
```

---

## í”„ë¡ íŠ¸ì—”ë“œ (FRONTEND)
### ğŸ“Œ `member.js` (íšŒì› ê°€ì… ìœ íš¨ì„± ê²€ì‚¬)
```javascript
const isValidEmail = (email) => {
  const emailPattern = /^[a-zA-Z0-9._%+-]+@[a-zA-Z0-9.-]+\.[a-zA-Z]{2,}$/;
  return emailPattern.test(email);
};

const isValidPassword = (password) => {
  const passwordPattern = /^(?=.*[0-9])(?=.*[!@#$%^&*]).{8,}$/;
  return passwordPattern.test(password);
};

const checkNicknameDuplicate = async (nickname) => {
  const response = await fetch(`/api/check-nickname?nickname=${nickname}`);
  const data = await response.json();
  return data.isDuplicate;
};

const registerUser = async (email, password, nickname) => {
  if (!isValidEmail(email)) {
    alert("ìœ íš¨í•œ ì´ë©”ì¼ì„ ì…ë ¥í•˜ì„¸ìš”.");
    return;
  }
  
  if (!isValidPassword(password)) {
    alert("ë¹„ë°€ë²ˆí˜¸ëŠ” 8ìë¦¬ ì´ìƒì´ë©°, ìˆ«ìì™€ íŠ¹ìˆ˜ë¬¸ìë¥¼ í¬í•¨í•´ì•¼ í•©ë‹ˆë‹¤.");
    return;
  }

  const isDuplicate = await checkNicknameDuplicate(nickname);
  if (isDuplicate) {
    alert("ì´ë¯¸ ì‚¬ìš© ì¤‘ì¸ ë‹‰ë„¤ì„ì…ë‹ˆë‹¤.");
    return;
  }

  const response = await fetch("/api/register", {
    method: "POST",
    headers: { "Content-Type": "application/json" },
    body: JSON.stringify({ email, password, nickname }),
  });

  if (response.ok) {
    alert("íšŒì›ê°€ì… ì„±ê³µ!");
  } else {
    alert("íšŒì›ê°€ì… ì‹¤íŒ¨.");
  }
};
```

---

# JWT

- ëª©ì  : ì¸ì¦ ë° ì •ë³´ ì „ë‹¬  

- JWTëŠ” ì‚¬ìš©ìì˜ ì¸ì¦ ìƒíƒœë¥¼ ìœ ì§€í•˜ê±°ë‚˜ íŠ¹ì • ì •ë³´ë¥¼ ì•ˆì „í•˜ê²Œ ì „ë‹¬í•˜ê¸° ìœ„í•´ ì‚¬ìš©ë¨  
- ì„œë²„ê°€ í´ë¼ì´ì–¸íŠ¸ì—ê²Œ ë°œê¸‰í•œ í›„, í´ë¼ì´ì–¸íŠ¸ëŠ” ì´ë¥¼ ìš”ì²­ ì‹œ í¬í•¨í•˜ì—¬ ë³´ëƒ„  
- JWT ë‚´ë¶€ì—ëŠ” ì„œëª…(Signature)ì´ ìˆì–´ ìœ„ë³€ì¡° ë°©ì§€ë¥¼ í•  ìˆ˜ ìˆìŒ  
- ì¼ë°˜ì ìœ¼ë¡œ **ë¡œê·¸ì¸ ì¸ì¦ í† í°**ìœ¼ë¡œ ì‚¬ìš©ë¨

## ë°±ì—”ë“œ (BACK)
### ğŸ“Œ `pom.xml`ì— `jjwt` ë¼ì´ë¸ŒëŸ¬ë¦¬ ì¶”ê°€

```xml
<dependency>
    <groupId>io.jsonwebtoken</groupId>
    <artifactId>jjwt</artifactId>
    <version>0.9.1</version>
</dependency>

<dependency>
    <groupId>javax.xml.bind</groupId>
    <artifactId>jaxb-api</artifactId>
    <version>2.3.0</version>
</dependency>
```

### ğŸ“Œ JWT ìœ í‹¸ë¦¬í‹° í´ë˜ìŠ¤ : `JwtTokenProvider.java`
í‘œì¤€ í¬ë§· jwtë¥¼ ìƒì„±/í™•ì¸ í•  ìˆ˜ ìˆëŠ” ìœ í‹¸ë¦¬í‹° í´ë˜ìŠ¤

```java
package com.shop.cafe.util;

import java.util.Base64;
import java.util.Date;
import io.jsonwebtoken.*;

public class JwtTokenProvider {
    private static String salt = Base64.getEncoder().encodeToString("ì†”íŠ¸".getBytes());

    // JWT ìƒì„±
    public static String createToken(String data) {
        Claims claims = Jwts.claims();
        claims.put("nickname", data);

        Date now = new Date();
        return Jwts.builder()
                .setHeaderParam(Header.TYPE, Header.JWT_TYPE)
                .setClaims(claims)
                .setIssuedAt(now)
                .setExpiration(new Date(now.getTime() + (1000L * 60 * 30))) // 30ë¶„ ìœ íš¨
                .signWith(SignatureAlgorithm.HS256, salt)
                .compact();
    }

    // JWT ìœ íš¨ì„± ê²€ì‚¬ : ë§Œë£Œì‹œê°„ì´ ì§€ë‚¬ìœ¼ë©´ trueì„. ê·¸ëŸ¬ë¯€ë¡œ !ì„ ë¶™ì—¬ì•¼í•¨
    public static boolean validateToken(String jwtToken) {
        return !getInformation(jwtToken).getExpiration().before(new Date());
    }

    // JWT ì •ë³´ ê°€ì ¸ì˜¤ê¸°
    public static Claims getInformation(String jwtToken) {
        return Jwts.parser().setSigningKey(salt).parseClaimsJws(jwtToken).getBody();
    }
}
```

### ğŸ“Œ JWTë¥¼ ì´ìš©í•œ íšŒì› ì¸ì¦ ì²˜ë¦¬ : `MemberService.java`

```java
package com.shop.cafe.service;

import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.stereotype.Service;
import com.shop.cafe.dao.*;
import com.shop.cafe.dto.*;
import com.shop.cafe.util.JwtTokenProvider;
import com.shop.cafe.util.OpenCrypt;
import java.util.Date;
import java.util.UUID;
import java.util.regex.Pattern;

@Service
public class MemberService {
    @Autowired
    MemberDao memberDao;
    
    @Autowired
    LoginDao loginDao;
    
    @Autowired
    SaltDao saltDao;

    // JWT í† í°ì„ ì´ìš©í•œ ë¡œê·¸ì¸
    public Login tokenLogin(Member m) throws Exception {
		String email=m.getEmail();
		//emailë¡œ saltë¥¼ ì°¾ì•„ì˜´
		SaltInfo saltInfo=saltDao.selectSalt(email);
		//pwdì— saltë¥¼ ë”í•˜ì—¬ ì•”í˜¸í™”
		String pwd=m.getPwd();
		byte [] pwdHash=OpenCrypt.getSHA256(pwd, saltInfo.getSalt());
		String pwdHashHex=OpenCrypt.byteArrayToHex(pwdHash);
		m.setPwd(pwdHashHex);
		// login
		m=memberDao.login(m);		

        if (m != null) {
            String nickname = m.getNickname();
            if (nickname != null && !nickname.trim().isEmpty()) {
                String jwtToken = JwtTokenProvider.createToken(nickname);
                Login loginInfo = new Login(email, jwtToken, nickname, null);
                loginDao.insertToken(loginInfo);
                return loginInfo;
            }
        }
        return null;
    }

    public void logout(String authorization) throws Exception {
        loginDao.deleteToken(authorization);
    }
}
```

---

### ğŸ“Œ  JWTë¥¼ í™œìš©í•œ ì¥ë°”êµ¬ë‹ˆ ê¸°ëŠ¥ : `CartController.java`

JWTë¥¼ ì´ìš©í•˜ì—¬ ì¸ì¦ëœ ì‚¬ìš©ìë§Œ ì¥ë°”êµ¬ë‹ˆì— ì¶”ê°€ ê°€ëŠ¥

```java
@RestController
@CrossOrigin("http://127.0.0.1:5500/")
public class CartController {
    
    @Autowired
    MemberService memberService;
    @Autowired
    CartService cartService;

    @PostMapping("addToCart")
    public String addToCart(@RequestHeader String authorization, @RequestBody Cart cart) {
        System.out.println(authorization);
        System.out.println(cart);
        try {
	    	if(JwtTokenProvider.validateToken(authorization)) { //ë¡œê·¸ì¸ ì‹œê°„ì´ ìœ íš¨í•œ ì§€ í™•ì¸
	    		Login loginInfo = memberService.checkToken(authorization); //emailì„ ê°€ì ¸ì˜¤ê¸° ìœ„í•¨
                cart.setEmail(loginInfo.getEmail());
                cart.setQuantity(1);
                cartService.addToCart(cart);
                return "ok";
            }
            return null;
        } catch (Exception e) {
            e.printStackTrace();
            return "Error";
        }
    }
}
```

---

### ğŸ” **JWT vs Hashing ì°¨ì´ì **

| êµ¬ë¶„ | JWT | Hashing |
|------|-----|---------|
| ëª©ì  | ì¸ì¦ ë° ì •ë³´ ì „ë‹¬ | ë°ì´í„° ë³´í˜¸ ë° ë¬´ê²°ì„± ê²€ì¦ |
| ë°©ì‹ | ì„œëª…(Signature)ê³¼ í•¨ê»˜ ì •ë³´ í¬í•¨ | ì›ë³¸ ë°ì´í„°ë¥¼ í•´ì‹œê°’ìœ¼ë¡œ ë³€í™˜ |
| ë³µí˜¸í™” ê°€ëŠ¥ ì—¬ë¶€ | ê°€ëŠ¥(ì„œëª… ê²€ì¦) | ë¶ˆê°€ëŠ¥(ë‹¨ë°©í–¥) |
| ì‚¬ìš© ì˜ˆì‹œ | ë¡œê·¸ì¸ í† í°, API ì¸ì¦ | ë¹„ë°€ë²ˆí˜¸ ì €ì¥, ë°ì´í„° ë¬´ê²°ì„± ê²€ì¦ |

```
Summary
- JWTëŠ” í´ë¼ì´ì–¸íŠ¸ì™€ ì„œë²„ ê°„ ì¸ì¦ì„ ìœ„í•´ ì‚¬ìš©
- Hashingì€ ë¹„ë°€ë²ˆí˜¸ ì €ì¥, ë°ì´í„° ê²€ì¦ ë“±ì„ ìœ„í•´ ì‚¬ìš©
- ë¹„ë°€ë²ˆí˜¸ë¥¼ ì €ì¥í•  ë•Œ JWTë¥¼ ì“°ë©´ ì•ˆ ë˜ê³ , ë°˜ëŒ€ë¡œ JWTë¥¼ í•´ì‹±í•˜ë©´ ì¸ì¦ ê¸°ëŠ¥ì„ ìƒìŒ!
```

---

## END