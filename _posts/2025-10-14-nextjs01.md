---
title: "React Router -> Next.js Router: ë¡œê·¸ì¸ ë¦¬ë‹¤ì´ë ‰íŠ¸ ë£¨í”„ ì›ì¸ê³¼ í•´ê²°ë²•"
categories: [Frontend, Next.js]
tags: [Next.js, Router, Zustand, persist, hydration]
image:
  path: /assets/post/React/letscareer.png
  alt: react
published: true
---


## ğŸ§© ë¬¸ì œ ìƒí™©

ë‹¤ìŒê³¼ ê°™ì€ ì½”ë“œë¡œ ë¡œê·¸ì¸ ìƒíƒœë¥¼ ì²´í¬í•˜ê³ , ë¹„ë¡œê·¸ì¸ ì‚¬ìš©ìëŠ” `/login` í˜ì´ì§€ë¡œ ë¦¬ë‹¤ì´ë ‰íŠ¸í•˜ë„ë¡ ì„¤ì •í–ˆë‹¤.

```tsx
if (!isLoggedIn) {
  const newUrl = new URL(window.location.href);
  const searchParams = new URLSearchParams();
  searchParams.set('redirect', `${newUrl.pathname}?${newUrl.search}`);
  router.push(`/login?${searchParams.toString()}`);
  return;
}
```

ê·¸ëŸ¬ë‚˜ Next.js í™˜ê²½ì—ì„œëŠ” ë¡œê·¸ì¸ë˜ì–´ ìˆìŒì—ë„ ë¶ˆêµ¬í•˜ê³  ë‹¤ìŒê³¼ ê°™ì€ ë¡œê·¸ê°€ ë°˜ë³µëë‹¤.

```
GET /challenge/296/135 200 in 80ms
GET /login?redirect=%2Fchallenge%2F296%2F135 200 in 77ms
GET /challenge/296/135 200 in 67ms
GET /login?redirect=%2Fchallenge%2F296%2F135 200 in 65ms
...
```

ì¦‰, **ë¡œê·¸ì¸ ìƒíƒœì—ì„œë„ ê³„ì† ë¡œê·¸ì¸ í˜ì´ì§€ì™€ ì›ë˜ í˜ì´ì§€ë¥¼ ì˜¤ê°€ëŠ” ë¬´í•œ ë£¨í”„**ê°€ ë°œìƒí–ˆë‹¤.

---

## ğŸ” ì›ì¸ ë¶„ì„

ê²°ë¡ ë¶€í„° ë§í•˜ë©´, ì›ì¸ì€ **Zustand `persist`ì˜ hydration(ë³µì›) ì§€ì—°**ì´ì—ˆë‹¤.

```ts
const useAuthStore = create(
  persist<AuthStore>(
    (set) => ({
      isLoggedIn: false,
      login: (accessToken, refreshToken) => {
        set({ accessToken, refreshToken, isLoggedIn: true });
      },
      logout: () => {
        set({ accessToken: undefined, refreshToken: undefined, isLoggedIn: false });
      },
    }),
    { name: 'userLoginStatus' },
  ),
);
```

Zustand `persist`ëŠ” localStorageì— ì €ì¥ëœ ìƒíƒœë¥¼ ë³µì›í•˜ê¸° ì „ì— ê¸°ë³¸ê°’(`isLoggedIn: false`)ì„ ë¨¼ì € ë°˜í™˜í•œë‹¤.
ì¦‰, ì‚¬ìš©ìëŠ” ì´ë¯¸ ë¡œê·¸ì¸ë˜ì–´ ìˆì§€ë§Œ, hydrationì´ ëë‚˜ê¸° ì „ê¹Œì§€ëŠ” `false`ë¡œ ì¸ì‹ë˜ëŠ” ê²ƒì´ë‹¤.

> React Router ì‹œì ˆì—ëŠ” CSRë¡œë§Œ ë Œë”ë§ë˜ì–´ ë¬¸ì œê°€ ë“œëŸ¬ë‚˜ì§€ ì•Šì•˜ì§€ë§Œ,
> Next.jsëŠ” **SSR + CSR ì „í™˜ ê³¼ì •**ì—ì„œ ì´ ì‹œì°¨ê°€ ëª…í™•íˆ ë“œëŸ¬ë‚œë‹¤.

ê·¸ ê²°ê³¼:

* ì´ˆê¸° ë Œë” ì‹œ â†’ `isLoggedIn === false`
* redirect ì‹¤í–‰ â†’ `/login?redirect=...`
* ë¡œê·¸ì¸ í˜ì´ì§€ ì§„ì… â†’ ë˜ë‹¤ì‹œ redirect ì¡°ê±´ ì‹¤í–‰ â†’ ë¬´í•œ ë£¨í”„ ë°œìƒ

---

## âœ… í•´ê²° ë°©ë²•

### 1. `initialized` í”Œë˜ê·¸ ì¶”ê°€

```ts
import { create } from 'zustand';
import { persist } from 'zustand/middleware';

interface AuthStore {
  isLoggedIn: boolean;
  initialized: boolean;
  accessToken?: string;
  refreshToken?: string;
  login: (accessToken: string, refreshToken: string) => void;
  logout: () => void;
}

const useAuthStore = create<AuthStore>()(
  persist(
    (set) => ({
      isLoggedIn: false,
      initialized: false,
      login: (accessToken, refreshToken) => {
        set({ accessToken, refreshToken, isLoggedIn: true });
      },
      logout: () => {
        set({ accessToken: undefined, refreshToken: undefined, isLoggedIn: false });
      },
    }),
    {
      name: 'userLoginStatus',
      onRehydrateStorage: () => {
        return () => {
          useAuthStore.setState({ initialized: true });
        };
      },
    }
  )
);

export default useAuthStore;
```

Hydrationì´ ì™„ë£Œë˜ë©´ `initialized: true`ë¡œ ë³€ê²½í•˜ì—¬,
`isLoggedIn` ê°’ì„ ì•ˆì „í•˜ê²Œ ì‚¬ìš©í•  ìˆ˜ ìˆê²Œ í–ˆë‹¤.

---

### 2. `AuthGuard`ì—ì„œ ì´ˆê¸° ë¡œë”© ë¶„ë¦¬

```tsx
"use client";

import { useEffect } from "react";
import { usePathname, useRouter } from "next/navigation";
import useAuthStore from "@/store/useAuthStore";

export default function AuthGuard({ children }: { children: React.ReactNode }) {
  const router = useRouter();
  const pathname = usePathname();
  const { isLoggedIn, initialized } = useAuthStore();

  useEffect(() => {
    if (!initialized) return; // âœ… ì•„ì§ ë³µì› ì¤‘ì´ë©´ ì•„ë¬´ ê²ƒë„ í•˜ì§€ ì•ŠìŒ
    if (!isLoggedIn && !pathname.startsWith("/login")) {
      router.push(`/login?redirect=${pathname}`);
    }
  }, [isLoggedIn, initialized, pathname, router]);

  if (!initialized) return null; // ë¡œë”© ì¤‘ì—ëŠ” ë¹ˆ í™”ë©´ ë˜ëŠ” ìŠ¤í”¼ë„ˆ í‘œì‹œ
  return <>{children}</>;
}
```

ì´ì œ `isLoggedIn` ìƒíƒœê°€ ë³µì›ë˜ê¸° ì „ì—ëŠ” redirect ë¡œì§ì´ ì‹¤í–‰ë˜ì§€ ì•ŠëŠ”ë‹¤.

---

## ğŸ§  ë°°ìš´ ì 

1. Zustand `persist`ëŠ” **ì´ˆê¸° ìƒíƒœë¥¼ ì¦‰ì‹œ ë°˜í™˜í•˜ê³ **,
   hydration ì´í›„ì—ì•¼ ì €ì¥ëœ ìƒíƒœë¥¼ ë³µì›í•œë‹¤.
2. Next.jsëŠ” **ì„œë²„-í´ë¼ì´ì–¸íŠ¸ ë Œë” íƒ€ì´ë°ì´ ë‹¬ë¼ì„œ**,
   CSR í™˜ê²½ë³´ë‹¤ ì´ëŸ° ë™ê¸°í™” ë¬¸ì œê°€ ë” ìì£¼ ë“œëŸ¬ë‚œë‹¤.
3. ìƒíƒœ ë³µì› ì „ì—ëŠ” **ì ˆëŒ€ ì¸ì¦/ë¦¬ë‹¤ì´ë ‰íŠ¸ ë¡œì§ì„ ì‹¤í–‰í•˜ì§€ ë§ì•„ì•¼ í•œë‹¤.**

---

## ğŸ’¬ ë§ˆë¬´ë¦¬

React Routerì—ì„œëŠ” ì „í˜€ ë¬¸ì œ ì—†ë˜ ì½”ë“œê°€,
Next.js Routerë¡œ ë„˜ì–´ì˜¤ë©´ì„œ ë™ì‘ íƒ€ì´ë° í•˜ë‚˜ ì°¨ì´ë¡œ í° ì´ìŠˆë¥¼ ë§Œë“¤ ìˆ˜ ìˆë‹¤.

ì´ë²ˆ ê²½í—˜ì„ í†µí•´ "hydration ì „í›„ ìƒíƒœ ê´€ë¦¬ì˜ ì¤‘ìš”ì„±"ì„ ë‹¤ì‹œ í•œë²ˆ ì²´ê°í–ˆë‹¤.
Next.jsë¡œ ë§ˆì´ê·¸ë ˆì´ì…˜í•  ë•ŒëŠ” ë‹¨ìˆœí•œ ë¼ìš°í„° ë³€ê²½ ì™¸ì—ë„
**ìƒíƒœ ê´€ë¦¬ ë¼ì´ë¸ŒëŸ¬ë¦¬ì˜ ë™ì‘ ì‹œì **ì„ ë°˜ë“œì‹œ ì ê²€í•´ì•¼ í•œë‹¤.

---

## END