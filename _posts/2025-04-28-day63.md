---
title: "[Day63] ë‚ ì”¨ API ì—°ë™"
categories: [Ureca, React]
tags: [React, JS]
image:
  path: /assets/post/2025/ureca/day63_class_1.png
  alt: React
published: true
---


## ğŸ”— ì‚¬ìš© API: [OpenWeatherMap](https://openweathermap.org/)

OpenWeatherMapì€ **ì „ ì„¸ê³„ ë‚ ì”¨ ì •ë³´ë¥¼ ì œê³µí•˜ëŠ” ë¬´ë£Œ API** ì´ë‹¤ !

<br/>

# âœ… API Key ë³´ì•ˆ ê´€ë¦¬

## `.env` íŒŒì¼ ìƒì„±

API KeyëŠ” ì™¸ë¶€ì— ë…¸ì¶œë˜ë©´ ì•ˆ ë˜ëŠ” ë¯¼ê° ì •ë³´ â†’ `.env` íŒŒì¼ì— ì €ì¥í•´ì„œ ì½”ë“œì—ì„œ ë¶„ë¦¬ ê´€ë¦¬

```
VITE_WEATHER_API_KEY = 8b7f7d685453d033636d45
```

- `.env` - ê¸°ë³¸ íŒŒì¼, ëª¨ë“  í™˜ê²½ì—ì„œ ë¡œë“œ
- `.env.local` - ë¡œì»¬ í™˜ê²½ ë³€ìˆ˜, gitì—ì„œ ë¬´ì‹œí•´ì•¼ í•¨
- `.env.development` - ê°œë°œ í™˜ê²½
- `.env.production` - í”„ë¡œë•ì…˜ í™˜ê²½
- `.env.test` - í…ŒìŠ¤íŠ¸ í™˜ê²½

### ğŸ“Œ Vite í™˜ê²½ì—ì„œì˜ ì£¼ì˜ì‚¬í•­

- `VITE_` ì ‘ë‘ì‚¬ëŠ” **Vite í™˜ê²½ì—ì„œë§Œ í•„ìˆ˜**
  - `VITE_API_KEY=abcdef123456` (O)
  - `API_KEY=abcdef123456` (X - í´ë¼ì´ì–¸íŠ¸ ì½”ë“œì—ì„œ ì ‘ê·¼ ë¶ˆê°€)
- `.env.local`ì€ ë°˜ë“œì‹œ `.gitignore`ì— ì¶”ê°€í•´ì„œ Gitì— ì˜¬ë¼ê°€ì§€ ì•Šë„ë¡ ê´€ë¦¬


### ğŸ“Œ í™˜ê²½ ë³€ìˆ˜ ì‚¬ìš© ì˜ˆì‹œ

```js
const API_KEY = import.meta.env.VITE_WEATHER_API_KEY;
const BASE_URL = "https://api.openweathermap.org/data/2.5/weather";

export const getWeatherByCurrentLocation = async (lat, lon) => {
  try {
    const res = await axios.get(
      `${BASE_URL}?lat=${lat}&lon=${lon}&appid=${API_KEY}&lang=kr&units=metric`
    );
    return res.data;
  } catch (error) {
    console.log("ë‚ ì”¨ ê°€ì ¸ì˜¤ê¸° ì‹¤íŒ¨", error);
  }
};
```

- `import.meta.env.VITE_ë³€ìˆ˜ëª…` ìœ¼ë¡œ ì‚¬ìš© ê°€ëŠ¥


------

# âœ… ê³µê³µ API ì‚¬ìš© ê°œìš”

## API ì—”ë“œí¬ì¸íŠ¸

- í˜„ì¬ ìœ„ì¹˜ ê¸°ë°˜:  
  `https://api.openweathermap.org/data/2.5/weather?lat={ìœ„ë„}&lon={ê²½ë„}&appid={API_KEY}`
- ë„ì‹œëª… ê¸°ë°˜:  
  `https://api.openweathermap.org/data/2.5/weather?q={ë„ì‹œëª…}&appid={API_KEY}`



## API í˜¸ì¶œ ì½”ë“œ êµ¬ì¡°

### ğŸ“‚ `useWeatherApi.js`  
ê³µí†µ API í˜¸ì¶œ í•¨ìˆ˜ë“¤ì„ ëª¨ì•„ë†“ì€ ìœ í‹¸ íŒŒì¼

```js
import axios from "axios";

const API_KEY = import.meta.env.VITE_WEATHER_API_KEY;
const BASE_URL = "https://api.openweathermap.org/data/2.5/weather";

// 1. ì¢Œí‘œ ê¸°ë°˜ ë‚ ì”¨ ì •ë³´
export const getWeatherByCurrentLocation = async (lat, lon) => {
  const res = await axios.get(
    `${BASE_URL}?lat=${lat}&lon=${lon}&appid=${API_KEY}&lang=kr&units=metric`
  );
  return res.data;
};
// 2. í˜„ì¬ ìœ„ì¹˜ ê¸°ë°˜ ë‚ ì”¨ ì •ë³´
export const getCurrentData = async () => {
  return new Promise((resolve, reject) => {
    navigator.geolocation.getCurrentPosition(
      async (pos) => {
        const { latitude, longitude } = pos.coords;
        const res = await getWeatherByCurrentLocation(latitude, longitude);
        resolve(res);
      },
      (err) => reject(err)
    );
  });
};
// 3. ë„ì‹œëª… ê¸°ë°˜ ë‚ ì”¨ ì •ë³´
export const getCountryData = async (city) => {
  const res = await axios.get(
    `${BASE_URL}?q=${city}&appid=${API_KEY}&lang=kr&units=metric`
  );
  return res.data;
};
```

#### ğŸ” ì™œ getCurrentDataì—ì„œ Promiseë¥¼ ìƒˆë¡œ ë§Œë“¤ì–´ì•¼ í• ê¹Œ?

`getCurrentData` í•¨ìˆ˜ì—ì„œ `Promise`ë¥¼ ì‚¬ìš©í•˜ëŠ” ì´ìœ ëŠ” **`navigator.geolocation.getCurrentPosition`ì´ `Promise`ë¥¼ ë°˜í™˜í•˜ì§€ ì•ŠëŠ” ì½œë°± ê¸°ë°˜ APIì´ê¸° ë•Œë¬¸** !

 âœ… ë¬¸ì œ ìƒí™©
```js
navigator.geolocation.getCurrentPosition(successCallback, errorCallback);
```

- ì´ APIëŠ” ì„±ê³µ ì‹œì—ëŠ” `successCallback`, ì‹¤íŒ¨ ì‹œì—ëŠ” `errorCallback`ì„ ì‹¤í–‰
- í•˜ì§€ë§Œ ë¹„ë™ê¸° ì‘ì—…ì„ì—ë„ ë¶ˆêµ¬í•˜ê³  `Promise`ë¥¼ ë°˜í™˜í•˜ì§€ ì•Šê¸° ë•Œë¬¸ì— `await`ìœ¼ë¡œ ì‚¬ìš©í•  ìˆ˜ ì—†ë‹¤

âœ… í•´ê²° ë°©ë²•: Promiseë¡œ ê°ì‹¸ê¸°

ìš°ë¦¬ê°€ ì›í•˜ëŠ” ê±´ ì•„ë˜ ì½”ë“œì²˜ëŸ¼ `getCurrentData`ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ê²ƒ

```js
const data = await getCurrentData();
```

ì´ë ‡ê²Œ ì“°ë ¤ë©´ `getCurrentData`ëŠ” `Promise`ë¥¼ ë°˜í™˜í•´ì•¼ í•˜ë¯€ë¡œ ê°ì‹¼ë‹¤ !

```js
export const getCurrentData = async () => {
  return new Promise((resolve, reject) => {
    navigator.geolocation.getCurrentPosition(
      async (pos) => {
        const { latitude, longitude } = pos.coords;
        const res = await getWeatherByCurrentLocation(latitude, longitude);
        resolve(res); // ì„±ê³µí•˜ë©´ ë‚ ì”¨ ë°ì´í„° ë°˜í™˜
      },
      (err) => reject(err) // ì‹¤íŒ¨í•˜ë©´ ì—ëŸ¬ ë°˜í™˜
    );
  });
};
```

ğŸ” íë¦„ ìš”ì•½
1. ë¸Œë¼ìš°ì €ê°€ `í˜„ì¬ ìœ„ì¹˜ ì¢Œí‘œ`ë¥¼ ê°€ì ¸ì˜¤ê¸° ìœ„í•´ `getCurrentPosition` í˜¸ì¶œ  
2. ì„±ê³µ ì‹œ â†’ ì¢Œí‘œ ë°›ì•„ì„œ `getWeatherByCurrentLocation`ìœ¼ë¡œ ë‚ ì”¨ ì •ë³´ ìš”ì²­  
3. ì´ ëª¨ë“  íë¦„ì„ í•˜ë‚˜ì˜ `Promise`ë¡œ ê°ì‹¸ì„œ `await`ìœ¼ë¡œ ë‹¤ë£° ìˆ˜ ìˆê²Œ ë³€í™˜

<br/>
ğŸ’¡

> ìš”ì•½í•˜ìë©´ `getCurrentPosition`ì€ ì˜¤ë˜ëœ APIë¼ì„œ ì½œë°± íŒ¨í„´ì„ ì‚¬ìš©              
> ê·¸ë˜ì„œ `async/await` íŒ¨í„´ì„ ì“°ë ¤ë©´ ì´ê±¸ `Promise`ë¡œ ê°ì‹¸ë©´ ë¹„ë™ê¸° íë¦„ì— í†µí•©í•˜ê²Œ í•´ì¤Œ     
> `getCurrentData`ëŠ” ì´ê±¸ ê°ì‹¸ì„œ, ìš°ë¦¬ê°€ í¸í•˜ê²Œ awaití•  ìˆ˜ ìˆë„ë¡ ë„ì™€ì£¼ëŠ” í•¨ìˆ˜


----

### ğŸ“‚ WeatherPage ì»´í¬ë„ŒíŠ¸
Reactì—ì„œ `useSearchParams`ë¥¼ í™œìš©í•´ ë„ì‹œëª…ì„ URLë¡œ ê´€ë¦¬í•˜ê³ ,  
ì„ íƒëœ ë„ì‹œ ë˜ëŠ” í˜„ì¬ ìœ„ì¹˜ì— ë”°ë¼ ë‚ ì”¨ë¥¼ ë³´ì—¬ì£¼ëŠ” êµ¬ì¡°

```js
import React, { useEffect, useState } from "react";
import css from "./WeatherPage.module.css";
import { getCurrentData } from "./useWeatherApi";
import { useSearchParams } from "react-router-dom";
import Button from "../weather/Button";
import { getCountryData } from "./useWeatherApi";

const WeatherPage = () => {
  const [searchParams, setSearchParams] = useSearchParams();
  const city = searchParams.get("city");
  const [weatherData, setWeatherData] = useState(null);

  const cityButtons = [
    { id: "current", label: "í˜„ì¬ìœ„ì¹˜" },
    { id: "seoul", label: "ì„œìš¸" },
    { id: "tokyo", label: "ë„ì¿„" },
    { id: "new york", label: "ë‰´ìš•" },
    { id: "paris", label: "íŒŒë¦¬" },
  ];
  useEffect(() => {
    const fetchWeatherData = async () => {
      try {
        let data;
        if (city) {
          data = await getCountryData(city);
        } else {
          data = await getCurrentData();
        }
        setWeatherData(data);
      } catch (err) {
        console.err(err);
      }
    };
    fetchWeatherData();
  }, [city]);

  const handleChangeCity = (city) => {
    if (city === "current") {
      setSearchParams({});
    } else {
      setSearchParams({ city });
    }
  };

  return (
    <main className={css.main}>
      <h2>WeatherPage</h2>
      <div className={css.weatherInfo}>
        <p className={css.location}>
          {weatherData?.sys.country} / {weatherData?.name}
        </p>
        <div className={css.temperature}>
          <p>{weatherData?.main.temp} &#8451;</p>
          <p>
            <img
              src={`http://openweathermap.org/img/wn/${weatherData?.weather[0].icon}.png`}
              alt="weather"
            />
          </p>
        </div>
      </div>
      <div className={css.btnList}>
        {cityButtons.map((button) => (
          <Button
            key={button.id}
            city={button.id}
            label={button.label}
            onClick={handleChangeCity}
          />
        ))}
      </div>
    </main>
  );
};

export default WeatherPage;
```

## ì‹¤í–‰ ê²°ê³¼ ì˜ˆì‹œ

<img src="/assets/post/2025/ureca/day63_class_1.png" alt="ë‚ ì”¨ UI" width=1300px>
<img src="/assets/post/2025/ureca/day63_class_2.png" alt="ë‚ ì”¨ UI" width=1300px>

- ë„ì‹œ ë²„íŠ¼ í´ë¦­ â†’ URLì— `?city=tokyo` ë“± ìë™ ë°˜ì˜
- `í˜„ì¬ ìœ„ì¹˜` í´ë¦­ ì‹œ geolocation APIë¡œ í˜„ì¬ ì¢Œí‘œ ìš”ì²­

------

## END

